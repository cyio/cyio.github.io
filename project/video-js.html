<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.37">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/favicon.ico"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#0089a7"><meta name="referrer" content="no-referrer"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><title>videojs | Oaker小站</title><meta name="description" content="Just playing around">
    <link rel="modulepreload" href="/assets/app.a25bf4c6.js"><link rel="modulepreload" href="/assets/video-js.html.fce286e1.js"><link rel="modulepreload" href="/assets/video-js.html.a459b646.js">
    <link rel="stylesheet" href="/assets/style.5af559d1.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">Oaker小站</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/javascript/concept.html" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></div><div class="navbar-item"><a href="/web/html.html" class="" aria-label="Web"><!--[--><!--]--> Web <!--[--><!--]--></a></div><div class="navbar-item"><a href="/frameworks/vue.html" class="" aria-label="框架"><!--[--><!--]--> 框架 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/node/concept.html" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></div><div class="navbar-item"><a href="/tools/markdown.html" class="" aria-label="工具"><!--[--><!--]--> 工具 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/javascript/algorithms/index.html" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/javascript/solutions/fib.html" class="" aria-label="题解"><!--[--><!--]--> 题解 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/cyio" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/javascript/concept.html" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></div><div class="navbar-item"><a href="/web/html.html" class="" aria-label="Web"><!--[--><!--]--> Web <!--[--><!--]--></a></div><div class="navbar-item"><a href="/frameworks/vue.html" class="" aria-label="框架"><!--[--><!--]--> 框架 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/node/concept.html" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></div><div class="navbar-item"><a href="/tools/markdown.html" class="" aria-label="工具"><!--[--><!--]--> 工具 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/javascript/algorithms/index.html" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/javascript/solutions/fib.html" class="" aria-label="题解"><!--[--><!--]--> 题解 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/cyio" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="videojs" tabindex="-1"><a class="header-anchor" href="#videojs" aria-hidden="true">#</a> videojs</h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/project/video-js.html#_1-内联播放" class="router-link-active router-link-exact-active">1. 内联播放</a></li><li><a aria-current="page" href="/project/video-js.html#_2-自动播放" class="router-link-active router-link-exact-active">2. 自动播放</a></li><li><a aria-current="page" href="/project/video-js.html#_3-播放控制" class="router-link-active router-link-exact-active">3. 播放控制</a></li><li><a aria-current="page" href="/project/video-js.html#_4-隐藏播放控件" class="router-link-active router-link-exact-active">4. 隐藏播放控件</a></li><li><a aria-current="page" href="/project/video-js.html#直播" class="router-link-active router-link-exact-active">直播</a></li><li><a aria-current="page" href="/project/video-js.html#全屏事件" class="router-link-active router-link-exact-active">全屏事件</a></li><li><a aria-current="page" href="/project/video-js.html#在视频全屏上层显示元素" class="router-link-active router-link-exact-active">在视频全屏上层显示元素</a></li><li><a aria-current="page" href="/project/video-js.html#错误处理" class="router-link-active router-link-exact-active">错误处理</a></li><li><a aria-current="page" href="/project/video-js.html#测试资源" class="router-link-active router-link-exact-active">测试资源</a></li><li><a aria-current="page" href="/project/video-js.html#视频格式" class="router-link-active router-link-exact-active">视频格式</a></li><li><a aria-current="page" href="/project/video-js.html#播放器样式" class="router-link-active router-link-exact-active">播放器样式</a></li><li><a aria-current="page" href="/project/video-js.html#加密解密" class="router-link-active router-link-exact-active">加密解密</a></li><li><a aria-current="page" href="/project/video-js.html#关键指标监控上报" class="router-link-active router-link-exact-active">关键指标监控上报</a></li><li><a aria-current="page" href="/project/video-js.html#卸载和清除" class="router-link-active router-link-exact-active">卸载和清除</a></li><li><a aria-current="page" href="/project/video-js.html#倍速播放" class="router-link-active router-link-exact-active">倍速播放</a></li><li><a aria-current="page" href="/project/video-js.html#网络自适应" class="router-link-active router-link-exact-active">网络自适应</a></li><li><a aria-current="page" href="/project/video-js.html#data-setup" class="router-link-active router-link-exact-active">data-setup</a></li><li><a aria-current="page" href="/project/video-js.html#组件" class="router-link-active router-link-exact-active">组件</a></li><li><a aria-current="page" href="/project/video-js.html#fade" class="router-link-active router-link-exact-active">fade</a></li><li><a aria-current="page" href="/project/video-js.html#主题-theme" class="router-link-active router-link-exact-active">主题 theme</a></li><li><a aria-current="page" href="/project/video-js.html#点播使用-m3u8" class="router-link-active router-link-exact-active">点播使用 m3u8</a></li><li><a aria-current="page" href="/project/video-js.html#版本" class="router-link-active router-link-exact-active">版本</a></li><li><a aria-current="page" href="/project/video-js.html#_5-6-迁移" class="router-link-active router-link-exact-active">5-6 迁移</a></li><li><a aria-current="page" href="/project/video-js.html#恢复播放" class="router-link-active router-link-exact-active">恢复播放</a></li><li><a aria-current="page" href="/project/video-js.html#组件-1" class="router-link-active router-link-exact-active">组件</a></li><li><a aria-current="page" href="/project/video-js.html#timeupdate" class="router-link-active router-link-exact-active">timeupdate</a></li><li><a aria-current="page" href="/project/video-js.html#ref" class="router-link-active router-link-exact-active">ref</a></li><li><a aria-current="page" href="/project/video-js.html#mp4" class="router-link-active router-link-exact-active">mp4</a></li><li><a aria-current="page" href="/project/video-js.html#转码" class="router-link-active router-link-exact-active">转码</a></li><li><a aria-current="page" href="/project/video-js.html#估算网速" class="router-link-active router-link-exact-active">估算网速</a></li><li><a aria-current="page" href="/project/video-js.html#dash-hls" class="router-link-active router-link-exact-active">DASH/HLS</a></li><li><a aria-current="page" href="/project/video-js.html#如何监听交互事件" class="router-link-active router-link-exact-active">如何监听交互事件</a></li><li><a aria-current="page" href="/project/video-js.html#mime" class="router-link-active router-link-exact-active">MIME</a></li><li><a aria-current="page" href="/project/video-js.html#获取远程视频文件大小" class="router-link-active router-link-exact-active">获取远程视频文件大小</a></li><li><a aria-current="page" href="/project/video-js.html#源码" class="router-link-active router-link-exact-active">源码</a><ul><li><a aria-current="page" href="/project/video-js.html#index-js" class="router-link-active router-link-exact-active">index.js</a></li><li><a aria-current="page" href="/project/video-js.html#video-js" class="router-link-active router-link-exact-active">video.js</a></li><li><a aria-current="page" href="/project/video-js.html#player-js" class="router-link-active router-link-exact-active">player.js</a></li><li><a aria-current="page" href="/project/video-js.html#tech-js" class="router-link-active router-link-exact-active">tech.js</a></li><li><a aria-current="page" href="/project/video-js.html#component-js" class="router-link-active router-link-exact-active">component.js</a></li><li><a aria-current="page" href="/project/video-js.html#load-progress-bar-js" class="router-link-active router-link-exact-active">load-progress-bar.js</a></li><li><a aria-current="page" href="/project/video-js.html#fullscreen-api-js" class="router-link-active router-link-exact-active">fullscreen-api.js</a></li><li><a aria-current="page" href="/project/video-js.html#其它" class="router-link-active router-link-exact-active">其它</a></li></ul></li></ul></nav><p><a href="https://github.com/videojs/video.js/blob/master/docs/guides/player-workflows.md#accesing-the-tech-on-the-player" target="_blank" rel="noopener noreferrer">video.js/player-workflows.md at master · videojs/video.js · GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="_1-内联播放" tabindex="-1"><a class="header-anchor" href="#_1-内联播放" aria-hidden="true">#</a> 1. 内联播放</h2><p>在 video 标签加 webkit-playsinline, webkit-playsinline(iOS10) 属性 或者 webview.allowsInlineMediaPlayback = YES</p><p>iOS10 之前，不支持 参考这个 http://stackoverflow.com/a/37967643/5657916 <a href="https://webkit.org/blog/6784/new-video-policies-for-ios/" target="_blank" rel="noopener noreferrer">New video Policies for iOS | WebKit<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 兼容 iOS 89 的方案 <a href="https://github.com/bfred-it/iphone-inline-video" target="_blank" rel="noopener noreferrer">bfred-it/iphone-inline-video: 📱 Make videos playable inline on the iPhone (prevents automatic fullscreen)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 线上测试 https://bfred-it.github.io/iphone-inline-video/demo/</p><p>poster 在 android 下兼容不好，不如在视频上层加个 div 铺张图片 解决：视频上加一层 div 做封面，由于 android 不允许视频上层有东西，所以首先将视频设为<code>width: 1px</code>，当播放后，上层的封面 remove 掉，同时<code>width：100%</code>或者你想要的宽度。</p><h2 id="_2-自动播放" tabindex="-1"><a class="header-anchor" href="#_2-自动播放" aria-hidden="true">#</a> 2. 自动播放</h2><p>android / chrome 70 是不允许自动播放的，即使你用了 video.play() ,也是不行的。必须有用户的主动触发，比如触摸了屏幕，有 click 或 touch 事件产生</p><h2 id="_3-播放控制" tabindex="-1"><a class="header-anchor" href="#_3-播放控制" aria-hidden="true">#</a> 3. 播放控制</h2><p>常用方法：<code>play|pause</code></p><p>常用事件：</p><div class="language-text ext-text"><pre class="language-text"><code>loadstart 开始加载
loadedmetadata 元信息加载成功
loadeddata 首帧加载成功
canplay
canplaythrough
ended
timeupdate
</code></pre></div><p>ios 需要播放后才会触发<code>canplay</code>和<code>canplaythrough</code></p><h2 id="_4-隐藏播放控件" tabindex="-1"><a class="header-anchor" href="#_4-隐藏播放控件" aria-hidden="true">#</a> 4. 隐藏播放控件</h2><p>android 下无法隐藏控件，可通过增加高度将控件顶出视窗以间接实现，有些副作用需要处理</p><p><a href="http://imweb.io/topic/560a6015c2317a8c3e086207" target="_blank" rel="noopener noreferrer">video 标签在不同平台上的事件表现差异分析 - 腾讯 Web 前端 IMWeb 团队社区 | blog | 团队博客<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="http://webcache.googleusercontent.com/search?q=cache:K3Kfv-HA0sMJ:www.xuanfengge.com/html5-video-play.html+&amp;cd=1&amp;hl=zh-CN&amp;ct=clnk&amp;gl=cn" target="_blank" rel="noopener noreferrer">移动端 HTML5 video 视频播放优化实践 - 轩枫阁 – 前端开发 | web 前端技术博客<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 2015 年的不一定新 <a href="https://github.com/mister-ben/videojs-flvjs" target="_blank" rel="noopener noreferrer">mister-ben/videojs-flvjs: Video.js tech using flv.js for FLV playback<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="直播" tabindex="-1"><a class="header-anchor" href="#直播" aria-hidden="true">#</a> 直播</h2><ol><li>设置 flv 需要引入</li></ol><div class="language-text ext-text"><pre class="language-text"><code>video.js
flv.js
videojs-flvjs.js
</code></pre></div><p>配置</p><div class="language-text ext-text"><pre class="language-text"><code>  flvjs: {
    mediaDataSource: {
      isLive: true,
      cors: true,
      withCredentials: false,
    },
    // config: {},
  },
</code></pre></div><ol start="2"><li>界面</li></ol><p>检测<code>duartionChange</code>事件，UI 有变化，不符合只看直播的期望</p><p>videojs 在检测到直播流<code>duration &lt; 0</code>才会切到<code>LIVE</code>样式，在<code>video-js</code>上添加<code>vjs-live</code>，新版还会加上<code>vjs-liveui</code>，新版有问题先不要用（安卓、seek）</p><p>vjs-live-control 刚开始会隐藏，需要 hack 处理</p><div class="language-pug ext-pug"><pre class="language-pug"><code><span class="token tag"><span class="token attr-class">.video-js</span><span class="token attr-class">.vjs-live</span></span>
</code></pre></div><div class="language-css ext-css"><pre class="language-css"><code><span class="token selector">.vjs-live .vjs-control.vjs-live-control</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>需要找直播流测试？本地如何模拟 livego + ffmpeg</p><p><code>ffmpeg -re -i aliyunmedia.mp4 -c copy -f flv rtmp://localhost/live/test</code> 播放<code>http://localhost:7001/live/test.flv</code></p><p><a href="https://github.com/videojs/video.js/blob/f5fd94f61012af2269a5528746c7d62a7b435467/src/js/player.js#L2485" target="_blank" rel="noopener noreferrer">video.js/player.js at f5fd94f61012af2269a5528746c7d62a7b435467 · videojs/video.js<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://github.com/videojs/video.js/blob/6c644feaa0ccef6e5e88e8bf45dc9caa82a94503/docs/guides/live.md#the-new-user-interface" target="_blank" rel="noopener noreferrer">video.js / live.md at 6c644feaa0ccef6e5e88e8bf45dc9caa82a94503·videojs / video.js<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="http://tests.nuevolab.com/videojs/tests/livestream" target="_blank" rel="noopener noreferrer">VideoJs Live streaming example<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="全屏事件" tabindex="-1"><a class="header-anchor" href="#全屏事件" aria-hidden="true">#</a> 全屏事件</h2><p>只有一个<code>fullscreenchange</code>事件，要配合<code>isFullscreen</code>方法</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>videoPlayer<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;fullscreenchange&#39;</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isFullscreen <span class="token operator">=</span> self<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>videoPlayer<span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">isFullscreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;is fullscreen: &#39;</span><span class="token punctuation">,</span> isFullscreen<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><a href="https://github.com/videojs/video.js/issues/3009#issuecomment-172627411" target="_blank" rel="noopener noreferrer">FullScreen Events · Issue #3009 · videojs/video.js<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>注意事件元素、方法，老版本 Chrome（如 63），Safari 等都需要前缀</p><h2 id="在视频全屏上层显示元素" tabindex="-1"><a class="header-anchor" href="#在视频全屏上层显示元素" aria-hidden="true">#</a> 在视频全屏上层显示元素</h2><p>场景：上课场景的题板展示，全屏时显示休息提示</p><ul><li><p>自定义全屏元素 思路：</p><ol><li>卸载自带事件（视频上双击和点全屏按钮，文档可能找不到，通过捕获事件，查源码定位到）</li><li>给播放器和要前置元素的<strong>公共容器</strong>设置全屏</li></ol><p><a href="https://gist.github.com/cyio/a838a85a87c14257427babd3ecf828e6" target="_blank" rel="noopener noreferrer">videojs replaceFullscreen<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>如果只考虑 chrome，可以设置一个特别大的 z-index https://stackoverflow.com/a/16240314/5657916</p></li></ul><h2 id="错误处理" tabindex="-1"><a class="header-anchor" href="#错误处理" aria-hidden="true">#</a> 错误处理</h2><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token comment">// Prevent “The play() request was interrupted by a call to pause()” error?</span>
<span class="token comment">// Give the timeout enough time to avoid the race conflict.</span>
<span class="token keyword">var</span> waitTime <span class="token operator">=</span> <span class="token number">150</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Resume play if the element if is paused.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>paused<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> waitTime<span class="token punctuation">)</span>
</code></pre></div><h2 id="测试资源" tabindex="-1"><a class="header-anchor" href="#测试资源" aria-hidden="true">#</a> 测试资源</h2><p>测试源：G33K-TRICKS - Your source to Tips and Tricks : List of HLS Streaming video sample test URL http://g33ktricks.blogspot.com.br/2016/04/list-of-hls-streaming-video-sample-test.html 苹果的源有跨源限制，不要用</p><p>//player.alicdn.com/video/aliyunmedia.mp4</p><p>http://content.jwplatform.com/manifests/vM7nH0Kl.m3u8</p><p><a href="https://standaloneinstaller.com/blog/big-list-of-sample-videos-for-testers-124.html" target="_blank" rel="noopener noreferrer">Big list of sample videos for testers - standaloneinstaller.com<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.oschina.net/translate/http-partial-content-in-node-js" target="_blank" rel="noopener noreferrer">Node.js 中实现 HTTP 206 内容分片 - 开源中国<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="视频格式" tabindex="-1"><a class="header-anchor" href="#视频格式" aria-hidden="true">#</a> 视频格式</h2><p>查看<code>ffmpeg -i sample.flv</code></p><p><a href="https://github.com/Bilibili/flv.js/issues/291#issuecomment-378025263" target="_blank" rel="noopener noreferrer">Live FLV Stream on Android Chrome: &quot;Playback seems stuck at 0, seek to 0.009&quot; · Issue #291 · bilibili/flv.js<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="播放器样式" tabindex="-1"><a class="header-anchor" href="#播放器样式" aria-hidden="true">#</a> 播放器样式</h2><p>16:9 自适应，高度有最大最小限制</p><div class="language-css ext-css"><pre class="language-css"><code><span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
<span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
<span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>9 / 16<span class="token punctuation">)</span> * 100vw<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token property">max-height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100vh - 169px<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token property">min-height</span><span class="token punctuation">:</span> 480px<span class="token punctuation">;</span>
<span class="token property">background</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>
</code></pre></div><p>https://codepen.io/ncerminara/pen/zbKAD</p><p>http://stackoverflow.com/questions/25228056/responsive-iframe-using-bootstrap</p><p>原理： 容器设置相对定位，宽度100%，高度由 padding-bottom 设置，视频撑满容器，随容器伸缩 <a href="https://github.com/surmon-china/vue-video-player/blob/master/examples/01-video.vue" target="_blank" rel="noopener noreferrer">vue-video-player/01-video.vue at master · surmon-china/vue-video-player<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="加密解密" tabindex="-1"><a class="header-anchor" href="#加密解密" aria-hidden="true">#</a> 加密解密</h2><p>支持 AES-128 segment encryption <a href="https://www.linkedin.com/pulse/content-protection-hls-aes-128-encryption-steven-tielemans" target="_blank" rel="noopener noreferrer">Content Protection for HLS with AES-128 Encryption<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ul><li>密钥保护</li><li>防盗播，需要自建服务器</li></ul><p>比较：</p><ul><li><p>MPS 私有加密 - 阿里私有服务</p><ul><li>不支持 H5（调研时）</li><li>必须使用阿里 CDN</li><li>安全性高</li></ul></li><li><p>HLS 标准加密</p><p><a href="https://github.com/hauk0101/video-hls-encrypt" target="_blank" rel="noopener noreferrer">hauk0101/video-hls-encrypt: 一个基于 hls 协议的视频加密 Demo<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://help.aliyun.com/document_detail/57113.html" target="_blank" rel="noopener noreferrer">视频加密<em>用户指南</em>媒体处理-阿里云<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.alibabacloud.com/help/zh/doc-detail/68565.htm" target="_blank" rel="noopener noreferrer">如何进行 HLS 的加密与播放 - 最佳实践| 阿里云<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://juejin.im/post/5c471a50f265da613a5452f6" target="_blank" rel="noopener noreferrer">腾讯云点播 - 视频防盗加密 - 使用总结 - 掘金<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul><h2 id="关键指标监控上报" tabindex="-1"><a class="header-anchor" href="#关键指标监控上报" aria-hidden="true">#</a> 关键指标监控上报</h2><ul><li>播放成功率 - play/canplay event</li><li>首次缓冲时间/加载延迟 = loadeddata - loadstart</li><li>缓冲概率</li><li>卡顿缓冲时长 = playing - waiting，忽略第一次 playing，如果大于一定值，收集网速信息，上报</li><li>播放次数</li><li>下载进度 video.duration video.buffered.end(0)</li></ul><p>收集信息：</p><ul><li>视频地址</li><li>即时带宽</li></ul><p><a href="https://gist.github.com/cyio/13ff0ff11de9d5507958aea3343f3611" target="_blank" rel="noopener noreferrer">视频加载延迟、卡顿计算及上报<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://blog.daraw.cn/2018/09/07/video-quality-monitor/" target="_blank" rel="noopener noreferrer">前端视频质量监控 | DaraW | Code is Poetry<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://www.cnblogs.com/chenpingzhao/p/6850595.html" target="_blank" rel="noopener noreferrer">十亿级视频播放技术优化揭密 - 踏雪无痕 SS - 博客园<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="卸载和清除" tabindex="-1"><a class="header-anchor" href="#卸载和清除" aria-hidden="true">#</a> 卸载和清除</h2><p>一旦加载，会一直拉取，需要特殊操作停止拉取</p><p>需要两步，无法通过仅移除节点解决</p><p>一个页面视频比较多时，会阻塞后面的</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token comment">// 2) Clear the video source URL</span>
oldVideo<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>

<span class="token comment">// 3) Tell the video to start loading &quot;nothing&quot;</span>
oldVideo<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><a href="https://stackoverflow.com/questions/28105950/html5-video-stalled-event" target="_blank" rel="noopener noreferrer">javascript - HTML5 video: stalled event - Stack Overflow<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="倍速播放" tabindex="-1"><a class="header-anchor" href="#倍速播放" aria-hidden="true">#</a> 倍速播放</h2><ul><li>h5 原生支持</li><li>Chrome mutes the audio if the rate is lower than 0.5, or higher than 4.0.</li><li>常用值 1.5|2 <a href="https://github.com/videojs/videojs-playbackrate-adjuster" target="_blank" rel="noopener noreferrer">videojs/videojs-playbackrate-adjuster: A Video.js 6 middleware that adjusts controls based on playback rate<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h2 id="网络自适应" tabindex="-1"><a class="header-anchor" href="#网络自适应" aria-hidden="true">#</a> 网络自适应</h2><p><a href="https://myslide.cn/slides/491?vertical=1" target="_blank" rel="noopener noreferrer">播放器原理（何李石） | MySlide - 专注 PPT 分享，追随 SlideShare 和 SpeakerDeck 的脚步<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>清晰度：分为普清、高清、超清、原画和 4k，分别对应 360p、480p、720p、1080p 和以上</p><p>使用这个支持 v6 的 fork 版本</p><p>原插件只支持 v5，v6 变化较大，不要用 npm/cdn 版本，是旧的</p><p><a href="https://github.com/neilhem/videojs-resolution-switcher" target="_blank" rel="noopener noreferrer">neilhem/videojs-resolution-switcher: Resolution switcher adds the ability to select the video quality in video.js player.<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="data-setup" tabindex="-1"><a class="header-anchor" href="#data-setup" aria-hidden="true">#</a> data-setup</h2><p>会自动初始化，不要和手动初始化同时使用</p><h2 id="组件" tabindex="-1"><a class="header-anchor" href="#组件" aria-hidden="true">#</a> 组件</h2><p>排序</p><ol><li>children 插件会影响</li></ol><div class="language-javascript ext-js"><pre class="language-javascript"><code>    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&#39;playToggle&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;durationDisplay&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;timeDivider&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;currentTimeDisplay&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;progressControl&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;volumePanel&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;fullscreenToggle&#39;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><ol start="2"><li>flex order tab 键切换还是按 html 顺序 <blockquote><p>Flex order change visual order, but html order stays the same. When you change focused element with your keyboard (TAB key) it keeps order defined by HTML. Tab index is scoped globally, so it is not right solution.</p></blockquote></li><li>re-order your plugin initialization order so the plugins add their buttons in a different order.</li></ol><h2 id="fade" tabindex="-1"><a class="header-anchor" href="#fade" aria-hidden="true">#</a> fade</h2><p><a href="https://stackoverflow.com/questions/24641448/video-js-force-control-bar-fade-out" target="_blank" rel="noopener noreferrer">video.js: force control bar fade out - Stack Overflow<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="主题-theme" tabindex="-1"><a class="header-anchor" href="#主题-theme" aria-hidden="true">#</a> 主题 theme</h2><p>参考： <a href="https://www.nuevolab.com/videojs/tests/hls" target="_blank" rel="noopener noreferrer">Videojs HLS Adaptive Streaming with quality resolution picker<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 百度网盘的视频播放也是基于 videojs</p><p><a href="https://docs.videojs.com/docs/api/progress-control.html" target="_blank" rel="noopener noreferrer">ProgressControl<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="点播使用-m3u8" tabindex="-1"><a class="header-anchor" href="#点播使用-m3u8" aria-hidden="true">#</a> 点播使用 m3u8</h2><ul><li>可减轻服务器压力</li><li>首次加载更快？</li></ul><p><a href="https://www.helloweba.net/javascript/571.html" target="_blank" rel="noopener noreferrer">HTML5 点播 m3u8(hls)格式视频_Helloweba<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="http://www.ppvod.com/dianbo/wenti/443.html" target="_blank" rel="noopener noreferrer">为什么网络点播系统使用 m3u8 更有优势-PPVOD 视频点播源码/直播平台/服务器转码软件系统<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="版本" tabindex="-1"><a class="header-anchor" href="#版本" aria-hidden="true">#</a> 版本</h2><p>videojs 7 集成 <a href="https://github.com/videojs/http-streaming" target="_blank" rel="noopener noreferrer">http-streaming<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 插件。如果不需要，使用 core.js</p><h2 id="_5-6-迁移" tabindex="-1"><a class="header-anchor" href="#_5-6-迁移" aria-hidden="true">#</a> 5-6 迁移</h2><ul><li><p><code>src()</code>改为异步</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>player<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;video/mp4&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">&#39;foo.mp4&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
player<span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>play<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a href="https://github.com/videojs/video.js/wiki/Video.js-6-Migration-Guide" target="_blank" rel="noopener noreferrer">Video.js 6 Migration Guide · videojs/video.js Wiki<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul><h2 id="恢复播放" tabindex="-1"><a class="header-anchor" href="#恢复播放" aria-hidden="true">#</a> 恢复播放</h2><ul><li>需要 loadedmetadata 发生后</li><li>需要校验有效性？</li></ul><div class="language-javascript ext-js"><pre class="language-javascript"><code>player<span class="token punctuation">.</span><span class="token function">currentTime</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastTimeCopy<span class="token punctuation">)</span>
player<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><a href="https://gist.github.com/alecsgone/a6db03bade4dc405a61c63294a64f97a" target="_blank" rel="noopener noreferrer">VideoJS event list<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://juejin.im/post/5adb020df265da0b7c06d970" target="_blank" rel="noopener noreferrer">[Video.js]隐藏和显示视频播放器控件 - 掘金<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="组件-1" tabindex="-1"><a class="header-anchor" href="#组件-1" aria-hidden="true">#</a> 组件</h2><p><a href="https://docs.videojs.com/tutorial-components.html#creating-a-component" target="_blank" rel="noopener noreferrer">Tutorial: components | Video.js Documentation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="timeupdate" tabindex="-1"><a class="header-anchor" href="#timeupdate" aria-hidden="true">#</a> timeupdate</h2><ul><li>50ms - 250ms</li><li>如果需要精确控制，可以使用<code>requestAnimationFrame</code>，并在里面检查<code>player.currentTime()</code></li></ul><h2 id="ref" tabindex="-1"><a class="header-anchor" href="#ref" aria-hidden="true">#</a> ref</h2><p><a href="http://vcloud.163.com/vcloud-sdk-manual/WebDemos/LivePlayer_Web/introToComponent.html" target="_blank" rel="noopener noreferrer">视频云web播放器样式和组件自定义<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="mp4" tabindex="-1"><a class="header-anchor" href="#mp4" aria-hidden="true">#</a> mp4</h2><p>moov 需要放在开头，以启用 faststart</p><p>判断 moov 位置，在第一行（说明在开头），还是第二行（说明在末尾）</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># zsh 里后面命令需要转义</span>
ffmpeg -v trace -i file.mp4 <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">grep</span> -e type:<span class="token punctuation">\</span>&#39;mdat<span class="token punctuation">\</span>&#39; -e type:<span class="token punctuation">\</span>&#39;moov<span class="token punctuation">\</span>&#39;
</code></pre></div><p><a href="https://stackoverflow.com/questions/56963790/how-to-tell-if-faststart-for-video-is-set-using-ffmpeg-or-ffprobe" target="_blank" rel="noopener noreferrer">How to tell if faststart for video is set using ffmpeg or ffprobe - Stack Overflow<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://veerit.com/other/optimizing-mp4-video-for-fast-streaming-in-2019/" target="_blank" rel="noopener noreferrer">Optimizing MP4 Video for Fast Streaming in 2019 - VeerIT Solutions<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://segmentfault.com/a/1190000012477812" target="_blank" rel="noopener noreferrer">在线短视频秒播优化之视频文件格式之MP4文件Moov box的位置 - 个人文章 - SegmentFault 思否<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>重新排序，moov 放到开头</p><div class="language-bash ext-sh"><pre class="language-bash"><code>ffmpeg -i input.mp4 -movflags faststart -acodec copy -vcodec copy output.mp4
</code></pre></div><h2 id="转码" tabindex="-1"><a class="header-anchor" href="#转码" aria-hidden="true">#</a> 转码</h2><p><a href="https://askubuntu.com/questions/352920/fastest-way-to-convert-videos-batch-or-single" target="_blank" rel="noopener noreferrer">ffmpeg - Fastest way to convert videos (batch or single)? - Ask Ubuntu<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://trac.ffmpeg.org/wiki/Encode/H.264" target="_blank" rel="noopener noreferrer">Encode/H.264 – FFmpeg<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://blog.csdn.net/u013010310/article/details/52371440" target="_blank" rel="noopener noreferrer">FFMPEG推流到RTMP服务器命令 - u013010310的专栏 - CSDN博客<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://www.jianshu.com/p/6f345eaf3471" target="_blank" rel="noopener noreferrer">ffmpeg录制摄像头 - 简书<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://wx2.sinaimg.cn/large/69d3c9d2gy1g78ijxhwvxj20v00d6q7a.jpg" alt="youtube 指标"><a href="https://blog.csdn.net/chenchong_219/article/details/44263691" target="_blank" rel="noopener noreferrer">MP4文件格式解析 - 心之所向，身之所往 - CSDN博客<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="http://www.chromium.org/audio-video" target="_blank" rel="noopener noreferrer">Audio/Video - The Chromium Projects<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://www.w3.org/2018/12/webmediaguidelines.html#byte-range-requests-in-context-of-web-video-application" target="_blank" rel="noopener noreferrer">Web Media Application Developer Guidelines<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://medium.com/canal-tech/how-video-streaming-works-on-the-web-an-introduction-7919739f7e1" target="_blank" rel="noopener noreferrer">How video streaming works on the web: An introduction<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>将1080p转成720p，宽度自适应</p><div class="language-bash ext-sh"><pre class="language-bash"><code>ffmpeg -i input.mkv -c copy -c:v libx264 -vf <span class="token assign-left variable">scale</span><span class="token operator">=</span>-2:720 output.mkv
</code></pre></div><p><a href="https://www.5yun.org/14696.html" target="_blank" rel="noopener noreferrer">ffmpeg 将1080P视频转换成720P_楚盟网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="估算网速" tabindex="-1"><a class="header-anchor" href="#估算网速" aria-hidden="true">#</a> 估算网速</h2><ol><li>文件大小/下载所用时间</li><li>视频下载本身符合上条</li></ol><p><a href="https://webapps.stackexchange.com/questions/106358/how-does-youtube-detect-connection-speed-without-testing-using-all-speeds" target="_blank" rel="noopener noreferrer">How does YouTube detect connection speed without testing/using all speeds? - Web Applications Stack Exchange<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://stackoverflow.com/questions/5529718/how-to-detect-internet-speed-in-javascript" target="_blank" rel="noopener noreferrer">How to detect internet speed in JavaScript? - Stack Overflow<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="dash-hls" tabindex="-1"><a class="header-anchor" href="#dash-hls" aria-hidden="true">#</a> DASH/HLS</h2><p>DASH 第一个国际标准</p><p>HLS 不是标准，chrome 移动端支持，pc 端可能永远不会支持</p><blockquote><p>DASH客户端可以根据当前的网络状况，自动选择对应的最匹配的比特率文件段下载，进行回放，而不会引起停顿或重新缓冲。这样，DASH客户端可以无缝地适应不断变化的网络条件，并提供高品质的播放，而能够尽量减少播放的停顿或缓冲。 虽然DASH是国际标准，但是 HLS 出现的更早，在业界占主流。</p></blockquote><p><a href="https://juejin.im/post/5d0892a0e51d455a694f9533" target="_blank" rel="noopener noreferrer">权利的游戏、破冰行动都烂尾了，那就来讨论一下视频点播吧 - 掘金<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.bilibili.com/read/cv855111/" target="_blank" rel="noopener noreferrer">我们为什么使用DASH - 哔哩哔哩<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><blockquote><p>HTMLVideoElement.getVideoPlaybackQuality() 中新增firstFrameTime（首帧时间）和bufferTimes（卡顿次数）以及希望获取总共可使用 MSE 的内存上限</p></blockquote><p>fmp4 不需要一个 moov Box 来进行 initialization，fmp4 的 moov Box 只包含了一些 track 信息。 fmp4 可以结合 MSE 进行 HTML5 直播。</p><p><a href="https://www.w3.org/2019/03/23-chinese-web-media-summary.html#item05" target="_blank" rel="noopener noreferrer">W3C Web 中文兴趣组媒体特别任务组研讨会 -- 2019年3月23日<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><blockquote><p>我们不看瞬时速度，而是对最近请求的4-10个分片计算平均值</p></blockquote><p><a href="https://h5player.bytedance.com/api/#getbufferedrange" target="_blank" rel="noopener noreferrer">西瓜播放器 | API<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>播放本地视频，需要指定类型，blob 无法判断，不指定类型没有报错 <a href="https://stackoverflow.com/questions/36035721/how-can-i-set-preview-of-video-file-selecting-from-input-type-file/40580663" target="_blank" rel="noopener noreferrer">javascript - How can I set preview of video file, selecting from input type=&#39;file&#39; - Stack Overflow<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://github.com/videojs/video.js/issues/5504#issuecomment-481143136" target="_blank" rel="noopener noreferrer">Blob Url Support broke with 7.2.1 · Issue #5504 · videojs/video.js<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="如何监听交互事件" tabindex="-1"><a class="header-anchor" href="#如何监听交互事件" aria-hidden="true">#</a> 如何监听交互事件</h2><p>如用户操作触发暂停</p><p>pause 有问题，跳转也会触发，但可通过 readyState 区分开，4 是用户操作，1 是 seek 或加载时的用户操作</p><p><a href="https://stackoverflow.com/questions/40584563/html5-video-fires-pause-event-while-seeked" target="_blank" rel="noopener noreferrer">html - HTML5 video fires pause event while seeked - Stack Overflow<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>click，需要排除 dbclick，用户是在点击播放还是暂停</p><p><a href="https://html.spec.whatwg.org/multipage/media.html#the-video-element" target="_blank" rel="noopener noreferrer">HTML Standard<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://ws1.sinaimg.cn/large/4e5d3ea7ly1gb33uahrhvj20am08ct9n.jpg" alt="image.png"></p><p>监听交互事件可能更容易，缺点是如果通过快捷键跳转可能需要单独判断</p><h2 id="mime" tabindex="-1"><a class="header-anchor" href="#mime" aria-hidden="true">#</a> MIME</h2><p>&quot;application/octet-stream&quot; 例外 浏览器不会忽略</p><h2 id="获取远程视频文件大小" tabindex="-1"><a class="header-anchor" href="#获取远程视频文件大小" aria-hidden="true">#</a> 获取远程视频文件大小</h2><ul><li>额外发<code>HEAD</code>请求，获取<code>content-length</code></li><li>需要服务器支持<code>HEAD</code>方法，需要支持CORS（可能是多个域名）。目前阿里 OSS 可以配多个、支持通配符，而 CDN 只支持配一个、精确</li></ul><p><a href="https://bitexperts.com/Question/Detail/3316/determine-file-size-in-javascript-without-downloading-a-file" target="_blank" rel="noopener noreferrer">Determine file size in JavaScript without downloading a file<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-text ext-text"><pre class="language-text"><code>    // not work 如何延迟设置自动隐藏
    // player.on(&#39;loadeddata&#39;, function() {
    // this.options.inactivityTimeout = 2000
    // })
</code></pre></div><p>写 CSS 类 姓名 复姓 新姓缩写</p><p><a href="https://github.com/f2e-journey/xueqianban/issues/61" target="_blank" rel="noopener noreferrer">视频直播的技术原理和实现思路方案整理 · Issue #61 · f2e-journey/xueqianban<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="源码" tabindex="-1"><a class="header-anchor" href="#源码" aria-hidden="true">#</a> 源码</h2><p>https://github.com/videojs/video.js/tree/main/src/js</p><h3 id="index-js" tabindex="-1"><a class="header-anchor" href="#index-js" aria-hidden="true">#</a> index.js</h3><p>导入 videojs/hls，然后导出</p><h3 id="video-js" tabindex="-1"><a class="header-anchor" href="#video-js" aria-hidden="true">#</a> video.js</h3><p>核心模块</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">videojs</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> options<span class="token punctuation">,</span> ready</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

</code></pre></div><p>如果 player 实例存在，直接返回</p><p>否则返回 new PlayerComponent 实际得到 player 组件，这个组件在 player.js 中注册<code>Component.registerComponent(&#39;Player&#39;, Player);</code></p><p>方法属性方式，扩展功能</p><h3 id="player-js" tabindex="-1"><a class="header-anchor" href="#player-js" aria-hidden="true">#</a> player.js</h3><p>TECH_EVENTS_RETRIGGER 注释描述各个事件作用 很清晰</p><h3 id="tech-js" tabindex="-1"><a class="header-anchor" href="#tech-js" aria-hidden="true">#</a> tech.js</h3><p>播放所使用技术，主要用的是 html5</p><p>tech 与 source 结合</p><p>技术顺序 使用哪个技术来播放，按 tech 数组顺序查找</p><p>IE10 不支持原生 HLS/MSE，可官方插件 flash tech 支持 HLS</p><p>html5.js wrapper tech.js component</p><p>https://github.com/videojs/video.js/blob/main/docs/guides/tech.md</p><p>扩展示例：https://github.dev/mister-ben/videojs-flvjs/blob/master/src/plugin.js 继承、修改了 html5.js</p><blockquote><p>video.js 和 flv.js 都是 Apache 2.0，可以闭源使用，需要说明</p></blockquote><h3 id="component-js" tabindex="-1"><a class="header-anchor" href="#component-js" aria-hidden="true">#</a> component.js</h3><p>Component UI 基础类</p><p>是否存在有效 buffer 判断</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> buffered<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>buffered<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> currentTime <span class="token operator">&amp;&amp;</span>
          currentTime <span class="token operator">&lt;</span> buffered<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">SAFE_TIME_DELTA</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          extraBuffer <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
</code></pre></div><p>buffered 百分比计算，遍历 buffered 并累加 / duration</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">bufferedPercent</span><span class="token punctuation">(</span><span class="token parameter">buffered<span class="token punctuation">,</span> duration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre></div><p>内置依赖 xhr 库 https://github.com/naugtur/xhr</p><h3 id="load-progress-bar-js" tabindex="-1"><a class="header-anchor" href="#load-progress-bar-js" aria-hidden="true">#</a> load-progress-bar.js</h3><p>进度条百分比计算</p><div class="language-text ext-text"><pre class="language-text"><code>      const percent = percentify(bufferedEnd, duration);
</code></pre></div><p>私有变量，下划线改放在后面</p><p>缓冲小区间展示 for buffered</p><p>估算网速，可以计算从时间 a 到时间 b 的 buffered 总时长变化 @todo</p><p>进度条更新，需要一直更新渲染，使用 rAF</p><h3 id="fullscreen-api-js" tabindex="-1"><a class="header-anchor" href="#fullscreen-api-js" aria-hidden="true">#</a> fullscreen-api.js</h3><p>适配器模式</p><ol><li>不同浏览器 api 字典</li><li>检测当前浏览器支持哪个 api 集合<code>if (apiMap[i][1] in document) {</code></li><li>适配成标准 api 语法 <code>FullscreenApi[specApi[i]] = browserApi[i];</code></li><li>挂在 Player 类上</li></ol><p>优点：统一，test mock 不用再写一遍</p><h3 id="其它" tabindex="-1"><a class="header-anchor" href="#其它" aria-hidden="true">#</a> 其它</h3><p>worker? 字幕合成等 https://github.com/videojs/http-streaming/blob/af5b4eee6605feb3a927efee1234f0ca49c32e72/src/media-segment-request.js#L472</p><p>concatSegments https://github.com/videojs/http-streaming/blob/e50f4c93dc47cc9ce467aeff8ddd61e1ef9e7814/src/util/segment.js#L43</p><p>appendBuffer https://github.com/videojs/http-streaming/blob/ea3650a08de481ac01f5562e54278e736a852e5c/src/segment-loader.js#L1918</p><p><a href="https://medium.com/yemeksepeti-teknoloji/what-ive-learned-from-working-with-html5-video-over-a-month-485c5d5c2045" target="_blank" rel="noopener noreferrer">What I’ve Learned From Working With HTML5 Video Over A Month | by Onur Şuyalçınkaya | Yemeksepeti Teknoloji | Medium<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://html.spec.whatwg.org/multipage/media.html#ready-states" target="_blank" rel="noopener noreferrer">HTML Standard<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://ffmpeg.xianwaizhiyin.net/base-knowledge/raw-yuv.html" target="_blank" rel="noopener noreferrer">YUV色彩空间 · FFmpeg原理<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: icaner@qq.com">cyio</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.a25bf4c6.js" defer></script>
  </body>
</html>
