import{r as n,o as s,c as a,a as e,F as p,d as t,b as o}from"./app.26466922.js";const c={},u=t('<h1 id="mse-api" tabindex="-1"><a class="header-anchor" href="#mse-api" aria-hidden="true">#</a> MSE api</h1><p>[toc]</p><p>提供无插件流媒体支持</p><p>之前只能播放整个文件，或用 Flash</p><p>分割合并 arraybuffers</p><p>src =&gt; MediaSource Object(Blob) [SourceBuffer]</p><p>更好粒度控制数据请求量、请求频率，控制内存使用，动态码率流基础 Dash/HLS</p><p>缺点：计算开销，耗电，iOS 仅 &gt;= iPadOS 13 支持</p><p>流程：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Download ---》 Response.arrayBuffer(适用fetch/xhr等异步获取流媒体数据) ---》 SourceBuffer(添加到MediaSource的buffer中) ---》 &lt;vedio/&gt; or &lt;autio/&gt;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>核心代码：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> mediaSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment">//console.log(mediaSource.readyState); // closed</span>\nvideo<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>mediaSource<span class="token punctuation">)</span>\nmediaSource<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;sourceopen&#39;</span><span class="token punctuation">,</span> sourceOpen<span class="token punctuation">)</span>\n\n<span class="token keyword">var</span> sourceBuffer <span class="token operator">=</span> mediaSource<span class="token punctuation">.</span><span class="token function">addSourceBuffer</span><span class="token punctuation">(</span>mimeCodec<span class="token punctuation">)</span>\n<span class="token function">fetchAB</span><span class="token punctuation">(</span>assetURL<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">buf</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  sourceBuffer<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;updateend&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    mediaSource<span class="token punctuation">.</span><span class="token function">endOfStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token comment">//console.log(mediaSource.readyState); // ended</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  sourceBuffer<span class="token punctuation">.</span><span class="token function">appendBuffer</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div>',12),r={href:"https://developer.mozilla.org/en-US/docs/Web/API/Media_Source_Extensions_API#media_source_extensions_concepts_and_usage",target:"_blank",rel:"noopener noreferrer"},l=o("Media Source API - Web APIs | MDN"),i={href:"https://nickdesaulniers.github.io/netfix/demo/bufferAll.html",target:"_blank",rel:"noopener noreferrer"},k=o("Ddmo"),d={href:"https://www.zhihu.com/question/314810515/answer/618143543",target:"_blank",rel:"noopener noreferrer"},b=o("「媒体源扩展(Media Source Extensions)」是什么，有什么应用场景？ - 知乎");c.render=function(t,o){const c=n("OutboundLink");return s(),a(p,null,[u,e("p",null,[e("a",r,[l,e(c)]),e("a",i,[k,e(c)])]),e("p",null,[e("a",d,[b,e(c)])])],64)};export default c;
