import{r as n,o as a,c as e,a as s,F as o,d as t,b as l}from"./app.0e74f851.js";const r={},p=t('<h1 id="分析" tabindex="-1"><a class="header-anchor" href="#分析" aria-hidden="true">#</a> 分析</h1><h2 id="数据收集" tabindex="-1"><a class="header-anchor" href="#数据收集" aria-hidden="true">#</a> 数据收集</h2><ul><li><code>unload</code>中的异步请求会被忽略，同步请求可用但页面<code>unload</code>延迟，减慢后续导航。拿不到 response</li><li><code>sendBeacon</code><ul><li>post</li><li>会自动带上 cookie</li><li>开发者工具：请求不在 xhr 中</li><li>不提供 response</li><li>发送数据类型有限制，需要接口支持。不支持 JSON？[1]</li></ul></li><li>fetch keepalive</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;unload&#39;</span><span class="token punctuation">,</span> logData<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">logData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token string">&quot;/log&quot;</span><span class="token punctuation">,</span> analyticsData<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>',4),c={href:"https://w3c.github.io/beacon/",target:"_blank",rel:"noopener noreferrer"},i=l("Beacon"),u=l("[1]: "),d={href:"https://stackoverflow.com/questions/31355128/how-to-receive-data-posted-by-navigator-sendbeacon-on-node-js-server",target:"_blank",rel:"noopener noreferrer"},h=l('javascript - How to receive data posted by "navigator.sendbeacon" on node.js server? - Stack Overflow'),b={href:"https://golb.hplar.ch/2018/09/beacon-api.html",target:"_blank",rel:"noopener noreferrer"},k=l("A closer look at the Beacon API"),g=s("h2",{id:"指标",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#指标","aria-hidden":"true"},"#"),l(" 指标")],-1),f=s("li",null,"跳出率 Bounce rate，只浏览某个页面即离开的会话 / 由该页开始的全部会话",-1),v=l("退出率，进入这一页，用户离开 / 全部访问 "),m={href:"https://support.google.com/analytics/answer/2525491?hl=zh-Hans&ref_topic=6156780",target:"_blank",rel:"noopener noreferrer"},w=l("退出率与跳出率 - Google Analytics（分析）帮助"),x=t('<h2 id="sendbeacon" tabindex="-1"><a class="header-anchor" href="#sendbeacon" aria-hidden="true">#</a> sendbeacon</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>blob = new Blob([`room_id=123`], {type : &#39;application/x-www-form-urlencoded&#39;});\nnavigator.sendBeacon(&quot;/cgi-bin/leave_room&quot;, blob);\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>(https://zhuanlan.zhihu.com/p/68838820)[https://zhuanlan.zhihu.com/p/68838820]</p>',3),y=l("sentry 不支持 "),j={href:"https://github.com/getsentry/sentry-javascript/issues/293#issuecomment-288626061",target:"_blank",rel:"noopener noreferrer"},B=l("navigator.sendBeacon() · Issue #293 · getsentry/sentry-javascript"),_=s("p",null,"后台有报警，第三方接口调用有盲区",-1);r.render=function(t,l){const r=n("OutboundLink");return a(),e(o,null,[p,s("p",null,[s("a",c,[i,s(r)])]),s("p",null,[u,s("a",d,[h,s(r)])]),s("p",null,[s("a",b,[k,s(r)])]),g,s("ul",null,[f,s("li",null,[v,s("a",m,[w,s(r)])])]),x,s("p",null,[y,s("a",j,[B,s(r)])]),_],64)};export default r;
