import{r as e,o as n,c as a,a as s,w as r,F as p,b as l,d as t}from"./app.26466922.js";const c={},i=s("h1",{id:"vue-3-æºç å­¦ä¹ ",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#vue-3-æºç å­¦ä¹ ","aria-hidden":"true"},"#"),l(" Vue 3 æºç å­¦ä¹ ")],-1),u={class:"table-of-contents"},b=l("è°ƒè¯•"),o=l("ç›®å½•ç»“æ„"),d=l("æ¨¡å—å…³ç³»"),m=l("createApp"),v=l("core api - runtime"),f=l("reactive"),h=l("è®¨è®ºç‚¹"),g=l("å‚è€ƒ"),x=t('<h2 id="è°ƒè¯•" tabindex="-1"><a class="header-anchor" href="#è°ƒè¯•" aria-hidden="true">#</a> è°ƒè¯•</h2><p>git clone git@github.com:vuejs/core.git vue3-core</p><h2 id="ç›®å½•ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ç›®å½•ç»“æ„" aria-hidden="true">#</a> ç›®å½•ç»“æ„</h2><p>packages</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>.\nâ”œâ”€â”€ compiler-core // ç¼–è¯‘æ ¸å¿ƒï¼ŒæŠ½è±¡è¯­æ³•æ ‘å’Œæ¸²æŸ“æ¡¥æ¥å®ç°\nâ”œâ”€â”€ compiler-dom // Dom å®ç°\nâ”œâ”€â”€ compiler-sfc // SFC å•æ–‡ä»¶ç»„ä»¶(.vue)çš„å®ç°\nâ”œâ”€â”€ compiler-ssr\nâ”œâ”€â”€ global.d.ts\nâ”œâ”€â”€ reactivity // å“åº”å¼\nâ”œâ”€â”€ runtime-core\nâ”œâ”€â”€ runtime-dom\nâ”œâ”€â”€ runtime-test\nâ”œâ”€â”€ server-renderer // æœåŠ¡ç«¯æ¸²æŸ“å®ç°\nâ”œâ”€â”€ shared  // package ä¹‹é—´å…±äº«çš„å·¥å…·åº“\nâ”œâ”€â”€ size-check\nâ”œâ”€â”€ template-explorer\nâ””â”€â”€ vue // å…¥å£ï¼Ÿ\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>compilerã€runtime æ¦‚å¿µåŒºåˆ« compiler æºç åˆ°å¯æ‰§è¡Œä»£ç ï¼Œruntime ç¨‹åºè¿è¡Œæ—¶</p><h2 id="æ¨¡å—å…³ç³»" tabindex="-1"><a class="header-anchor" href="#æ¨¡å—å…³ç³»" aria-hidden="true">#</a> æ¨¡å—å…³ç³»</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vue - packages/vue/src/index.ts\n    @vue/compiler-dom\n        @vue/compiler-core\n    @vue/runtime-dom\n        @vue/runtime-core\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="createapp" tabindex="-1"><a class="header-anchor" href="#createapp" aria-hidden="true">#</a> createApp</h2><p>æ–¹æ³•å…³ç³»ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>createRenderer\n baseCreateRenderer\n   createAppAPI\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// packages/runtime-core/src/renderer.ts\nfunction baseCreateRenderer\n  ...\n  return {\n    render,\n    hydrate,\n    createApp: createAppAPI(render, hydrate)\n  }\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>createAppAPI</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>app\n  use(plugin: Plugin, ...options: any[]) {\n  mixin(mixin: ComponentOptions) {\n  component(name: string, component?: Component): any {\n  directive(name: string, directive?: Directive) {\n\n  mount(\n  unmount() {\n  provide(key, value) {\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><pre><code>propsCache: new WeakMap(),\n</code></pre><h2 id="core-api-runtime" tabindex="-1"><a class="header-anchor" href="#core-api-runtime" aria-hidden="true">#</a> core api - runtime</h2><p><code>packages/runtime-core/src/index.ts</code>è´Ÿè´£å°†æœ€å¸¸ç”¨æ–¹æ³•ã€API å¯¼å‡º</p><p>defineComponent ç±»å‹ util</p><p>h - Hyperscript å‚æ•°åˆ¤æ–­ï¼Œå®é™…è°ƒç”¨ createVNode</p><p>v-if/v-for è§†ä¸º blockï¼Œå¯èƒ½åŠ¨æ€å˜æ›´</p><h2 id="reactive" tabindex="-1"><a class="header-anchor" href="#reactive" aria-hidden="true">#</a> reactive</h2><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c884b48e88a643e2b695b3587224b51d~tplv-k3u1fbpfcp-watermark.awebp" alt="reactive å·¥ä½œæµç¨‹"></p><p>æ–‡ä»¶ç»“æ„</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>â””â”€â”€ src\n    â”œâ”€â”€ baseHandlers.ts // åŸºæœ¬ç±»å‹çš„å¤„ç†å™¨\n    â”œâ”€â”€ collectionHandlers.ts  // Set Map WeakSet WeckMapçš„å¤„ç†å™¨\n    â”œâ”€â”€ computed.ts // è®¡ç®—å±æ€§ï¼ŒåŒVue2\n    â”œâ”€â”€ deferredComputed.ts // è®¡ç®—å±æ€§\n    â”œâ”€â”€ dep.ts // \n    â”œâ”€â”€ effect.ts // reactive æ ¸å¿ƒï¼Œå¤„ç†ä¾èµ–æ”¶é›†ï¼Œä¾èµ–æ›´æ–°\n    â”œâ”€â”€ effectScope.ts // \n    â”œâ”€â”€ index.ts\n    â”œâ”€â”€ operations.ts // å®šä¹‰ä¾èµ–æ”¶é›†ï¼Œä¾èµ–æ›´æ–°çš„ç±»å‹\n    â”œâ”€â”€ reactive.ts // reactive å…¥å£ï¼Œå†…éƒ¨ä¸»è¦ä»¥ Proxy å®ç°\n    â””â”€â”€ ref.ts // Proxy å¤„ç†ä¸äº†å€¼ç±»å‹çš„å“åº”ï¼ŒRef æ¥å¤„ç†\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ref å®ç°</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ref( é»˜è®¤æ·±æ‹·è´\n  createRef(\n    RefImpl(\n      toReactive å¯¹è±¡è°ƒç”¨ reactiveï¼Œéå¯¹è±¡ç›´æ¥è¿”å›\n         sObject(value) ? reactive(value) : value\n            createReactiveObject(mutableHandlers\n                new Proxy\n      get æ—¶ï¼Œè§¦å‘ä¾èµ–æ”¶é›†ã€è¿½è¸ª\n        trackEffects\n      set æ—¶ï¼Œè§¦å‘ä¾èµ–æ›´æ–°\n        triggerEffects\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>å®˜æ–¹æ–‡æ¡£ï¼šå¦‚æœä¼ å…¥ ref çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°†è°ƒç”¨ reactive æ–¹æ³•è¿›è¡Œæ·±å±‚å“åº”è½¬æ¢ã€‚</p></blockquote><p>effect ä½œä¸º reactive çš„æ ¸å¿ƒï¼Œä¸»è¦è´Ÿè´£ç›‘å¬å“åº”å¼æ•°æ®çš„å˜åŒ–ï¼Œè§¦å‘ç›‘å¬å‡½æ•°çš„æ‰§è¡Œé€»è¾‘</p><blockquote><p>Vue æœ€ç‹¬ç‰¹çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œæ˜¯å…¶éä¾µå…¥æ€§çš„å“åº”æ€§ç³»ç»Ÿã€‚æ•°æ®æ¨¡å‹æ˜¯è¢«ä»£ç†çš„ JavaScript å¯¹è±¡ã€‚</p></blockquote><p>åŸå§‹ç±»å‹å“åº”å¼è§£å†³æ–¹æ¡ˆï¼Œè½¬æ¢æˆå¯¹è±¡ï¼Œå¢åŠ <code>.value</code>ï¼Œæ¨¡æ¿è®¿é—®æ—¶è‡ªåŠ¨è§£å¥—</p><p>targetMap è®°å½• target object/property å’Œ effect å…³ç³»ï¼ŒäºŒå±‚æ•°æ®ç»“æ„ï¼š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>weakmap <span class="token operator">=</span> <span class="token punctuation">{</span>\n    targetObject<span class="token operator">:</span> map <span class="token operator">=</span> <span class="token punctuation">{</span>\n        targetProperty<span class="token operator">:</span> dep<span class="token operator">&lt;</span>effect array<span class="token operator">&gt;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>effectStack <code>push -&gt; run -&gt; pop</code></p><p>activeEffect å½“å‰è¿è¡Œçš„ effect</p><p>è®°å½•ä¾èµ–å…³ç³»æ—¶ï¼ŒæŸ¥è¯¢ activeEffect</p><p>setupResult æ˜¯ setup return çš„å¯¹è±¡</p><h2 id="è®¨è®ºç‚¹" tabindex="-1"><a class="header-anchor" href="#è®¨è®ºç‚¹" aria-hidden="true">#</a> è®¨è®ºç‚¹</h2><p>æ•°æ®å’Œé€»è¾‘èšåˆ</p><p>ä»¥åŠŸèƒ½æˆ–è€…èŒè´£æ¥ç»„ç»‡æ–‡ä»¶</p><p>æ–°çš„ API ç†è®ºä¸Šä¼šé™ä½ä»£ç è´¨é‡çš„æœ€ä½é—¨æ§›</p><p>setup ä½œç”¨æ˜¯ä¸ºäº†åˆæˆç”Ÿæˆç‰©ï¼Œä¾›å¤–éƒ¨è®¿é—®</p>',41),k={href:"https://stackoverflow.com/a/58500917",target:"_blank",rel:"noopener noreferrer"},y=l("vue.js - When to use setup() hook of Vue Composition API - Stack Overflow"),A=s("h2",{id:"å‚è€ƒ",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#å‚è€ƒ","aria-hidden":"true"},"#"),l(" å‚è€ƒ")],-1),j={href:"https://v3.cn.vuejs.org/guide/reactivity.html#%25E4%25BB%2580%25E4%25B9%2588%25E6%2598%25AF%25E5%2593%258D%25E5%25BA%2594%25E6%2580%25A7",target:"_blank",rel:"noopener noreferrer"},P=l("æ·±å…¥å“åº”æ€§åŸç† | Vue.js"),_={href:"https://segmentfault.com/a/1190000039691166",target:"_blank",rel:"noopener noreferrer"},E=l("æ¨è 7 ä¸ª Vue2ã€Vue3 æºç è§£å¯†åˆ†æçš„é‡ç£…å¼€æºé¡¹ç›® ğŸ‘ - SegmentFault æ€å¦");c.render=function(l,t){const c=e("RouterLink"),R=e("OutboundLink");return n(),a(p,null,[i,s("nav",u,[s("ul",null,[s("li",null,[s(c,{to:"#è°ƒè¯•"},{default:r((()=>[b])),_:1})]),s("li",null,[s(c,{to:"#ç›®å½•ç»“æ„"},{default:r((()=>[o])),_:1})]),s("li",null,[s(c,{to:"#æ¨¡å—å…³ç³»"},{default:r((()=>[d])),_:1})]),s("li",null,[s(c,{to:"#createapp"},{default:r((()=>[m])),_:1})]),s("li",null,[s(c,{to:"#core-api-runtime"},{default:r((()=>[v])),_:1})]),s("li",null,[s(c,{to:"#reactive"},{default:r((()=>[f])),_:1})]),s("li",null,[s(c,{to:"#è®¨è®ºç‚¹"},{default:r((()=>[h])),_:1})]),s("li",null,[s(c,{to:"#å‚è€ƒ"},{default:r((()=>[g])),_:1})])])]),x,s("p",null,[s("a",k,[y,s(R)])]),A,s("p",null,[s("a",j,[P,s(R)]),s("a",_,[E,s(R)])])],64)};export default c;
