import{_ as l,r as e,o as u,c as i,a as n,b as a,w as c,F as r,d as s,e as t}from"./app.11c4d450.js";const k={},d=n("h1",{id:"\u5F02\u6B65",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u5F02\u6B65","aria-hidden":"true"},"#"),s(" \u5F02\u6B65")],-1),m={class:"table-of-contents"},h=s("Promise"),b=s("\u53C2\u8003"),f=t(`<h2 id="promise" tabindex="-1"><a class="header-anchor" href="#promise" aria-hidden="true">#</a> Promise</h2><ul><li>\u6A21\u5757\u7528\u6CD5</li></ul><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fetchHtml</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div>`,3),_=n("p",null,"\u5728 then \u91CC\u9762\uFF08\u7B2C\u4E8C\u4E2A fn\uFF09\u5904\u7406 error\uFF0C\u4E0E\u5728\u5916\u9762 catch \u6709\u4F55\u533A\u522B\uFF1F",-1),y=n("li",null,[n("code",null,"catch()"),s("\u5373"),n("code",null,"Promise.prototype.catch(onRejected)"),s("\u76F8\u5F53\u4E8E"),n("code",null,"Promise.prototype.then(undefined, onRejected)")],-1),g=n("li",null,"catch \u80FD\u6355\u83B7 then \u4E2D\u629B\u51FA\u7684\u9519\u8BEF\uFF0C\u6BD4\u5728 then \u4E2D\u5904\u7406\u9519\u8BEF\u66F4\u597D",-1),w={href:"https://jsfiddle.net/x9bjmwo2/4/",target:"_blank",rel:"noopener noreferrer"},v=s("\u793A\u4F8B"),x=t(`<div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token function">apiCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;uh oh 1&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;this will catch the error&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div>`,1),j=n("li",null,[n("p",null,"Promise.all \u53EF\u4EE5\u5E76\u884C\u8BF7\u6C42\uFF0C\u4E5F\u5C31\u662F\u8BF4\u591A\u4E2A\u8BF7\u6C42\u4F9D\u8D56\u65F6\uFF0C\u90FD\u5C3D\u91CF\u5199\u6210 all \u5F62\u5F0F")],-1),P=t(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// bad</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">someAsyncFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">asyncGetUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> categories <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">asyncGetCategories</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> mapping <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">asyncMapUserWithCategory</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> categories<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// good</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">someAsyncFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> categories<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">asyncGetUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">asyncGetCategories</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> mapping <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">asyncMapUserWithCategory</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> categories<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="\u53C2\u8003" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003" aria-hidden="true">#</a> \u53C2\u8003</h3>`,2),C={href:"http://liubin.org/promises-book/",target:"_blank",rel:"noopener noreferrer"},E=s("JavaScript Promise \u8FF7\u4F60\u4E66\uFF08\u4E2D\u6587\u7248\uFF09");function F(G,L){const p=e("RouterLink"),o=e("ExternalLinkIcon");return u(),i(r,null,[d,n("nav",m,[n("ul",null,[n("li",null,[a(p,{to:"#promise"},{default:c(()=>[h]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#\u53C2\u8003"},{default:c(()=>[b]),_:1})])])])])]),f,n("ul",null,[n("li",null,[_,n("ul",null,[y,g,n("li",null,[n("a",w,[v,a(o)])])]),x]),j]),P,n("p",null,[n("a",C,[E,a(o)])])],64)}var R=l(k,[["render",F],["__file","async.html.vue"]]);export{R as default};
