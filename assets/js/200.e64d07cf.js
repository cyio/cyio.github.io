(window.webpackJsonp=window.webpackJsonp||[]).push([[200],{640:function(t,s,e){"use strict";e.r(s);var a=e(56),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"hls"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hls"}},[t._v("#")]),t._v(" HLS")]),t._v(" "),e("p",[t._v("[toc]")]),t._v(" "),e("h2",{attrs:{id:"协议对比"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#协议对比"}},[t._v("#")]),t._v(" 协议对比")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("视频协议")]),t._v(" "),e("th",[t._v("用途")]),t._v(" "),e("th",[t._v("PC")]),t._v(" "),e("th",[t._v("移动")]),t._v(" "),e("th",[t._v("延时")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("HLS(m3u8)")]),t._v(" "),e("td",[t._v("直播/点播")]),t._v(" "),e("td",[t._v("支持")]),t._v(" "),e("td",[t._v("支持")]),t._v(" "),e("td",[t._v("10-30s")])]),t._v(" "),e("tr",[e("td",[t._v("FLV(flash)")]),t._v(" "),e("td",[t._v("直播/点播")]),t._v(" "),e("td",[t._v("支持(需要用户安装启用 flash)")]),t._v(" "),e("td",[t._v("支持")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("HTTP-FLV")]),t._v(" "),e("td",[t._v("直播/点播")]),t._v(" "),e("td",[t._v("支持")]),t._v(" "),e("td",[t._v("ios safari 不支持")]),t._v(" "),e("td",[t._v("1-3s")])]),t._v(" "),e("tr",[e("td",[t._v("RTMP")]),t._v(" "),e("td",[t._v("只能直播")]),t._v(" "),e("td",[t._v("支持")]),t._v(" "),e("td",[t._v("不支持")]),t._v(" "),e("td",[t._v("3s")])]),t._v(" "),e("tr",[e("td",[t._v("MP4")]),t._v(" "),e("td",[t._v("只能点播")]),t._v(" "),e("td",[t._v("支持")]),t._v(" "),e("td",[t._v("支持")]),t._v(" "),e("td")])])]),t._v(" "),e("h2",{attrs:{id:"直播和点播"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#直播和点播"}},[t._v("#")]),t._v(" 直播和点播")]),t._v(" "),e("p",[t._v("直播是指视频源是实时的，一旦主播停播了，这个地址就已经失去意义了，而且由于是实时直播，所以播放器在播直播视频的时候是没有进度条的。\n点播是指视频源是一个服务器上的文件，文件只要没有被提供方删除，就随时可以播放， 而且由于整个视频都在服务器上，所以播放器在播点播视频的时候是有进度条的。")]),t._v(" "),e("h2",{attrs:{id:"协议兼容性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#协议兼容性"}},[t._v("#")]),t._v(" 协议兼容性")]),t._v(" "),e("p",[t._v("HLS，目前各手机浏览器产品对这种格式的兼容性最好，但它有个天然的问题，就是延迟比较\n大，一般是 20-30 秒左右的延迟，在手机浏览器上我们并没有其它选择。")]),t._v(" "),e("p",[t._v("在 PC 上情况会好很多，因为 PC 上的浏览器目前还没有抛弃 flash 控件，而 flash 控件不追求洁癖，支持的视频源格式挺多的，而且各浏览器上的 flash 控件\n都是 Adobe 自己开发，所以兼容性非常好。")]),t._v(" "),e("h2",{attrs:{id:"hls-高延迟"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hls-高延迟"}},[t._v("#")]),t._v(" HLS 高延迟")]),t._v(" "),e("p",[t._v("平均延时在10秒-30秒")]),t._v(" "),e("p",[t._v("在HLS中改变自适应流时，需要建立一个新的缓冲区。在撰写本文章当前，苹果公司默认使用10秒的内容区块和一定数量的数据包来创建播放缓冲区。这导致从捕获到最终数据包组装的新玻壳(glass-to-glass)延迟约30秒。但是，当您引入CDN以获得更高的可扩展性时，您会注入另外15-30秒的延迟时间以便服务器可以缓存正在进行的内容。其他更不用提，这就是HLS延迟的最大问题。")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&mid=2653547042&idx=1&sn=26d8728548a6b5b657079eeab121e283&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[t._v("移动直播技术秒开优化经验（含PPT）"),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://alanhou.org/live-video/",target:"_blank",rel:"noopener noreferrer"}},[t._v("直播开发入门学习笔记 | Alan Hou的个人博客"),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://yq.aliyun.com/articles/277195",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何降低直播延时？-云栖社区-阿里云"),e("OutboundLink")],1)]),t._v(" "),e("h2",{attrs:{id:"flv-js"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#flv-js"}},[t._v("#")]),t._v(" flv.js")]),t._v(" "),e("p",[t._v("缺点：不支持 ios safari")]),t._v(" "),e("h2",{attrs:{id:"https-域名-video-标签可以播放-http-源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#https-域名-video-标签可以播放-http-源"}},[t._v("#")]),t._v(" https 域名 video 标签可以播放 http 源")]),t._v(" "),e("p",[t._v("但通过 hls.js 等库去 fetch 不可以\n延伸：被动内容可以通过 http，如 Images Videos Audio")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://stackoverflow.com/questions/44392426/html5-playing-http-streaming-on-https-domain",target:"_blank",rel:"noopener noreferrer"}},[t._v("javascript - HTML5: Playing HTTP streaming on HTTPS domain - Stack Overflow"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://yq.aliyun.com/articles/511196",target:"_blank",rel:"noopener noreferrer"}},[t._v("视频直播常见问题与解决办法汇总【系列一】-云栖社区-阿里云"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://blog.csdn.net/ahoustep/article/details/52175732",target:"_blank",rel:"noopener noreferrer"}},[t._v("直播http-flv小调研 - ahoustep的博客 - CSDN博客"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://www.jianshu.com/p/bfdba8ab903a",target:"_blank",rel:"noopener noreferrer"}},[t._v("直播协议 HTTP-FLV 详解 - 简书"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/gwuhaolin/blog/issues/3",target:"_blank",rel:"noopener noreferrer"}},[t._v("为什么使用flv.js做直播 · Issue #3 · gwuhaolin/blog"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("m3u8是一段一段加载，速度快，不会卡，体验好。    mp4 是一开始加载视频头文件，如果mp4变大，就会开始卡几秒。")]),t._v(" "),e("h2",{attrs:{id:"加密-用第-2-个"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#加密-用第-2-个"}},[t._v("#")]),t._v(" 加密，用第 2 个")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("// 带压缩\nffmpeg -v verbose "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -re "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -i aliyunmedia.mp4 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -c:v libx264 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -b:v 5000k "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -f hls "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -hls_time "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -hls_list_size "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -hls_wrap "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("40")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -hls_delete_threshold "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -hls_flags delete_segments "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -hls_start_number_source datetime "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -preset superfast "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -start_number "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  ./stream.m3u8\n\nffmpeg "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -i ./source.mp4 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -vcodec copy "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -acodec copy "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -vbsf h264_mp4toannexb "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -hls_time "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -hls_key_info_file source.keyinfo "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -hls_playlist_type vod "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -hls_segment_filename "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./output/stream_%d.ts"')]),t._v(" ./output/stream.m3u8\n\n-hls_time 分片时长，苹果推荐 "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n-hls_key_info_file 加密配置\n")])])]),e("p",[e("a",{attrs:{href:"http://hlsbook.net/how-to-encrypt-hls-video-with-ffmpeg/",target:"_blank",rel:"noopener noreferrer"}},[t._v("How to Encrypt Video for HLS | HTTP Live Streaming"),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://ffmpeg.org/ffmpeg-formats.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("参数详解 - FFmpeg Formats Documentation"),e("OutboundLink")],1)]),t._v(" "),e("h2",{attrs:{id:"解密"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解密"}},[t._v("#")]),t._v(" 解密")]),t._v(" "),e("ol",[e("li",[t._v("修改 m3u8 里的 key uri 为本地路径。也可以把 ts 替换为完整路径，直接下载合并")]),t._v(" "),e("li")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("ffmpeg -allowed_extensions ALL -i stream.m3u8 -c copy new.mp4\n")])])]),e("p",[t._v("可以直接修改留一个 ts 作解密测试")]),t._v(" "),e("h2",{attrs:{id:"videojs-每次请求-key"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#videojs-每次请求-key"}},[t._v("#")]),t._v(" videojs 每次请求 key")]),t._v(" "),e("p",[t._v("可防止 key 失效，新版本支持手动控制，开发者自行处理缓存控制")]),t._v(" "),e("p",[t._v("https://github.com/videojs/http-streaming#cacheencryptionkeys\n"),e("a",{attrs:{href:"https://github.com/videojs/http-streaming/issues/367#issuecomment-482603212",target:"_blank",rel:"noopener noreferrer"}},[t._v("While doing HLS AES 128 playback, the player request key file for every chunk. · Issue #367 · videojs/http-streaming"),e("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);