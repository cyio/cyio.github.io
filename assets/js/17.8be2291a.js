(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{460:function(t,a,n){"use strict";n.r(a);var s=n(56),e=Object(s.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"解决-vue-多页编译慢问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决-vue-多页编译慢问题"}},[t._v("#")]),t._v(" 解决 Vue 多页编译慢问题")]),t._v(" "),n("h2",{attrs:{id:"问题描述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题描述"}},[t._v("#")]),t._v(" 问题描述：")]),t._v(" "),n("p",[t._v("vue-cli 创建的项目配置多页后，随着多页入口的增加，编译日渐缓慢，严重影响开发效率。")]),t._v(" "),n("p",[t._v("目前项目 12 个入口，启动服务 21 秒，热编译 3 秒（每保存一次代码，需要等 3 秒才能看效果）。")]),t._v(" "),n("p",[t._v("检查发现主要是"),n("code",[t._v("html-webpack-plugin")]),t._v("这个插件处理时间长，应该是原来针对单页设计，缺乏对多页的优化支持。")]),t._v(" "),n("p",[t._v("插件官方已经有对多页编译有一定优化的 4.x 版本，需要 webpack 4 的支持，尚未正式发布（vue-cli 3 引用的还是 3.x）")]),t._v(" "),n("h2",{attrs:{id:"解决步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决步骤"}},[t._v("#")]),t._v(" 解决步骤：")]),t._v(" "),n("ol",[n("li",[t._v("升级 vue-cli 3 正式版，webpack 升到 4")]),t._v(" "),n("li",[t._v("本地克隆"),n("code",[t._v("html-webpack-plugin")]),t._v("，并检出需要的特性分支"),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("cd node_modules/@vue/cli-service/node_modules\ngit clone https://github.com/jantimon/html-webpack-plugin.git\ngit checkout feature/cache-file-timestamps\n")])])])]),t._v(" "),n("li",[t._v("第 2 步操作完后，执行"),n("code",[t._v("yarn serve")]),t._v("无法启动服务，与"),n("code",[t._v("@vue/preload-webpack-plugin")]),t._v("有冲突，vue 官方对这个插件有定制，不好升级")]),t._v(" "),n("li",[t._v("禁用"),n("code",[t._v("preload")]),t._v("和"),n("code",[t._v("prefetch")]),t._v("插件，目前用不到，后续如果需要可以在最终打包时启用"),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vue.config.js")]),t._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("chainWebpack")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pagesObj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("entryName")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("prefetch-")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("entryName"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("preload-")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("entryName"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pwa'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])])])]),t._v(" "),n("h2",{attrs:{id:"结果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#结果"}},[t._v("#")]),t._v(" 结果")]),t._v(" "),n("p",[t._v("启动服务 15 秒，热编译 0.16 - 2 秒之间，至少节省 33% 的时间")]),t._v(" "),n("p",[t._v("在脚手架调整后，项目开发人员只要执行第 2 步替换旧的"),n("code",[t._v("html-webpack-plugin")]),t._v("插件即可")]),t._v(" "),n("p",[t._v("注意，暂时不要用 html-webpack-plugin 4.x，模板语法有变化，3.x 的配置编译会报错。")]),t._v(" "),n("h2",{attrs:{id:"参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/jantimon/html-webpack-plugin/pull/967",target:"_blank",rel:"noopener noreferrer"}},[t._v("feat(compiler): Use a single compiler for multiple plugin instances by jantimon · Pull Request #967 · jantimon/html-webpack-plugin"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/jantimon/html-webpack-plugin/issues/724#issuecomment-419885840",target:"_blank",rel:"noopener noreferrer"}},[t._v("Multiple entry points -> multiple html outputs webpack rebuild very slow · Issue #724 · jantimon/html-webpack-plugin"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://juejin.im/post/5af46971f265da0b95272330",target:"_blank",rel:"noopener noreferrer"}},[t._v("关于webpack多入口热加载很慢的原因 - 掘金"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"http://louiszhai.github.io/2019/01/04/webpack4/#%25E7%25BC%2596%25E8%25AF%2591%25E7%25BB%2593%25E6%259E%259C%25E5%2588%2586%25E6%259E%2590",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用webpack4提升180%编译速度 | louis blog"),n("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);