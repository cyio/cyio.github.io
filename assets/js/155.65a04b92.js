(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{594:function(_,v,l){"use strict";l.r(v);var e=l(56),o=Object(e.a)({},(function(){var _=this,v=_.$createElement,l=_._self._c||v;return l("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[l("h1",{attrs:{id:"npm-可复现构建"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#npm-可复现构建"}},[_._v("#")]),_._v(" npm 可复现构建")]),_._v(" "),l("hr"),_._v(" "),l("p",[_._v("package.json != 可复现构建")]),_._v(" "),l("p",[_._v("理想情况，输入"),l("code",[_._v("package.json")]),_._v("，输出确定"),l("code",[_._v("node_modules")])]),_._v(" "),l("hr"),_._v(" "),l("p",[_._v("影响因素：")]),_._v(" "),l("ul",[l("li",[_._v("使用不同版本 npm，安装算法略有差异")]),_._v(" "),l("li",[_._v("范围包，有更新，再安装时使用新版本")]),_._v(" "),l("li",[_._v("子依赖即使写死版本号，也会更新")]),_._v(" "),l("li",[_._v("安装包的远程库失效")])]),_._v(" "),l("hr"),_._v(" "),l("p",[_._v("npm install 策略")]),_._v(" "),l("ol",[l("li",[_._v("存在有效 lockfile，根据 lockfile 还原安装")]),_._v(" "),l("li",[_._v("否则，根据 package.json 重新计算依赖生成 lockfile， 进行安装")])]),_._v(" "),l("p",[_._v("问题:部署用途时不能保证可靠还原")]),_._v(" "),l("hr"),_._v(" "),l("p",[_._v("5.7.1 -- "),l("code",[_._v("npm ci")])]),_._v(" "),l("p",[_._v("只从 lockfile 进行复现安装\n适用于纯净部署，比常规安装更快更严格，帮助捕获错误或增量安装引起的不一致")]),_._v(" "),l("hr"),_._v(" "),l("ul",[l("li",[_._v("lockfile 与 "),l("code",[_._v("package.json")]),_._v(" 依赖不匹配时，会报错，而不是更新 lockfile")]),_._v(" "),l("li",[_._v("如查"),l("code",[_._v("node_modules")]),_._v("存在，会先删掉")]),_._v(" "),l("li",[_._v("可以做为"),l("code",[_._v("npm i")]),_._v("失败的回退，大幅降低安装失败的情况")])]),_._v(" "),l("hr"),_._v(" "),l("p",[_._v("建议，构建严格按 lockfile，开发忽略")]),_._v(" "),l("ul",[l("li",[_._v("保证构建稳定，不出现意料外依赖变化导致的问题")]),_._v(" "),l("li",[_._v("减少对开发者的工具要求，但要维护统一的 lockfile")]),_._v(" "),l("li",[_._v("开发和构建环境，npm 版本要限制最低 5.4.2")]),_._v(" "),l("li",[_._v("松散版本号的意义")])]),_._v(" "),l("hr"),_._v(" "),l("p",[_._v("缺点")]),_._v(" "),l("ul",[l("li",[_._v("不易读，lockfile 被破坏不易察觉")]),_._v(" "),l("li",[l("code",[_._v("package.json")]),_._v("无法反映真实使用依赖")])]),_._v(" "),l("hr"),_._v(" "),l("p",[_._v("完")]),_._v(" "),l("hr")])}),[],!1,null,null,null);v.default=o.exports}}]);