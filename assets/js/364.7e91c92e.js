(window.webpackJsonp=window.webpackJsonp||[]).push([[364],{804:function(t,s,a){"use strict";a.r(s);var e=a(56),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"单元测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单元测试"}},[t._v("#")]),t._v(" 单元测试")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#关于"}},[t._v("关于")]),a("ul",[a("li",[a("a",{attrs:{href:"#why"}},[t._v("why")])]),a("li",[a("a",{attrs:{href:"#how"}},[t._v("how")])])])]),a("li",[a("a",{attrs:{href:"#与端到端测试比较"}},[t._v("与端到端测试比较")])]),a("li",[a("a",{attrs:{href:"#jest"}},[t._v("Jest")]),a("ul",[a("li",[a("a",{attrs:{href:"#eslint"}},[t._v("eslint")])]),a("li",[a("a",{attrs:{href:"#运行测试"}},[t._v("运行测试")])]),a("li",[a("a",{attrs:{href:"#测试一个文件"}},[t._v("测试一个文件")])]),a("li",[a("a",{attrs:{href:"#测试覆盖率"}},[t._v("测试覆盖率")])]),a("li",[a("a",{attrs:{href:"#常用断言"}},[t._v("常用断言")])]),a("li",[a("a",{attrs:{href:"#timer-mock-异步代码"}},[t._v("timer mock / 异步代码")])])])]),a("li",[a("a",{attrs:{href:"#vue-组件测试"}},[t._v("Vue 组件测试")])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"关于"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于"}},[t._v("#")]),t._v(" 关于")]),t._v(" "),a("h3",{attrs:{id:"why"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#why"}},[t._v("#")]),t._v(" why")]),t._v(" "),a("ul",[a("li",[t._v("尽早发现代码缺陷，提高代码质量")]),t._v(" "),a("li",[t._v("有信心地重构代码")])]),t._v(" "),a("h3",{attrs:{id:"how"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how"}},[t._v("#")]),t._v(" how")]),t._v(" "),a("ul",[a("li",[t._v("成本收益权衡，采用哪种测试？")])]),t._v(" "),a("h2",{attrs:{id:"与端到端测试比较"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#与端到端测试比较"}},[t._v("#")]),t._v(" 与端到端测试比较")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("Unit/Integration")]),t._v(" "),a("th",[t._v("E2E")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("范围")]),t._v(" "),a("td",[t._v("最小可测试单元/单元集成")]),t._v(" "),a("td",[t._v("整体")])]),t._v(" "),a("tr",[a("td",[t._v("环境")]),t._v(" "),a("td",[t._v("Node")]),t._v(" "),a("td",[t._v("Browser")])]),t._v(" "),a("tr",[a("td",[t._v("框架")]),t._v(" "),a("td",[t._v("Jest/Mocha")]),t._v(" "),a("td",[t._v("Cypress/Nightwatch")])]),t._v(" "),a("tr",[a("td",[t._v("编写角色")]),t._v(" "),a("td",[t._v("开发")]),t._v(" "),a("td",[t._v("测试")])]),t._v(" "),a("tr",[a("td",[t._v("优点")]),t._v(" "),a("td",[t._v("容易编写，隔离，便于定位修复")]),t._v(" "),a("td",[t._v("模拟用户、真实")])]),t._v(" "),a("tr",[a("td",[t._v("缺点")]),t._v(" "),a("td",[t._v("无法保证整体工作如何")]),t._v(" "),a("td",[t._v("编写、维护成本高，反馈滞后")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://2.bp.blogspot.com/-YTzv_O4TnkA/VTgexlumP1I/AAAAAAAAAJ8/57-rnwyvP6g/s1600/image02.png",alt:"测试金字塔"}})]),t._v(" "),a("blockquote",[a("p",[t._v("你应该瞄准以下金字塔，主要关注单元和集成测试，70/20/10")])]),t._v(" "),a("blockquote",[a("p",[t._v("单元测试是轻量级的，旨在单独检查系统的特定功能/组件 - 它们应该很快并且为您提供即时且非常具体的反馈 - 代码中的哪一行发生错误，出现了\n什么问题。")])]),t._v(" "),a("blockquote",[a("p",[t._v("另一方面，端到端测试工作更高层次 - 从用户的角度检查整个应用程序，所有移动部件协同工作。 当 e2e 测试失败没有给出关于出错的地方，导致失败\n的地点和原因的信息时，这种情况很常见。")])]),t._v(" "),a("blockquote",[a("p",[t._v("一个标准的互联网应用产品的前端部分，我粗略估计大概有 20%的业务基础代码比较稳定，比如通用组件、通用算法和数据模块等，可以针对这些建立\n复杂一些的 API 和 GUI 测试用例来保证质量。剩下 80%的部分不是很稳定，每天都在迭代，针对他们维护 case 的成本非常高。目前业界中号称做了\n自动化测试的项目，也大多是在做那稳定的 20%。")])]),t._v(" "),a("blockquote",[a("ul",[a("li",[t._v("Unit test: Test classes")]),t._v(" "),a("li",[t._v("Integration test: Test component (class + template) using ComponentFixture")]),t._v(" "),a("li",[t._v("E2E: Mimic user inputs using Protractor and Selenium")])])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://cli.vuejs.org/config/#unit-testing",target:"_blank",rel:"noopener noreferrer"}},[t._v("Configuration Reference | Vue CLI 3"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://softwareengineering.stackexchange.com/questions/198918/end-to-end-tests-versus-unit-tests-should-tests-be-decoupled",target:"_blank",rel:"noopener noreferrer"}},[t._v("tdd - End-to-end tests versus unit tests, should tests be decoupled? - Software Engineering Stack Exchange"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://testing.googleblog.com/2015/04/just-say-no-to-more-end-to-end-tests.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Testing Blog: Just Say No to More End-to-End Tests"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"jest"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jest"}},[t._v("#")]),t._v(" Jest")]),t._v(" "),a("h3",{attrs:{id:"eslint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eslint"}},[t._v("#")]),t._v(" eslint")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v(".eslintrc.js")]),t._v(" 增加")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("env\n  jest: true,\n")])])]),a("p",[t._v("否则会有 lint 错误，如"),a("code",[t._v("it")]),t._v("未声明")]),t._v(" "),a("h3",{attrs:{id:"运行测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行测试"}},[t._v("#")]),t._v(" 运行测试")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" unit / jest\n")])])]),a("h3",{attrs:{id:"测试一个文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试一个文件"}},[t._v("#")]),t._v(" 测试一个文件")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" unit tests/unit/modal.spec.js\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" unit --watch tests/unit/modal.spec.js\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" unit --watch --debug tests/unit/modal.spec.js\n")])])]),a("h3",{attrs:{id:"测试覆盖率"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试覆盖率"}},[t._v("#")]),t._v(" 测试覆盖率")]),t._v(" "),a("ul",[a("li",[t._v("收集")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("--"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("coverage"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("collectCoverage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("ul",[a("li",[t._v("统计范围")])]),t._v(" "),a("p",[t._v("白名单")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("collectCoverageFrom [array]\nDefault: undefined\n")])])]),a("p",[t._v("黑名单")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('coveragePathIgnorePatterns [array]\nDefault: ["/node_modules/"]\n')])])]),a("p",[t._v("匹配到的文件，即使没写测试，也会参与统计")]),t._v(" "),a("p",[t._v("默认会收集全部 JS？")]),t._v(" "),a("h3",{attrs:{id:"常用断言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用断言"}},[t._v("#")]),t._v(" 常用断言")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wrapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isVisible")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wrapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("props")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'show'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wrapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("emitted")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBeTruthy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// toBeTruthy if 语句为真")]),t._v("\n")])])]),a("h3",{attrs:{id:"timer-mock-异步代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#timer-mock-异步代码"}},[t._v("#")]),t._v(" timer mock / 异步代码")]),t._v(" "),a("ol",[a("li",[a("p",[a("code",[t._v("done")]),t._v(" 显式指定测试结束，ajax、vuex action 在 nextTick 里断言")]),t._v(" "),a("p",[t._v("注意，done 需要调用，否则会提示一个 timeout 错误")])])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("beforeAll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("done "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* call it or remove it*/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("done")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// calling it")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("code",[t._v("jest.useFakeTimers()")]),t._v("原生定时器功能依赖"),a("strong",[t._v("真实")]),t._v("时间，测试需要控制时间，假时间")]),t._v(" "),a("li",[a("code",[t._v("jest.runAllTimers();")]),t._v("执行微任务队列，"),a("strong",[t._v("快进")]),t._v("直到所有定时器执行")]),t._v(" "),a("li",[t._v("promise/await")])]),t._v(" "),a("h2",{attrs:{id:"vue-组件测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-组件测试"}},[t._v("#")]),t._v(" Vue 组件测试")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://vue-test-utils.vuejs.org/zh/api/wrapper/#%25E5%25B1%259E%25E6%2580%25A7",target:"_blank",rel:"noopener noreferrer"}},[t._v("Wrapper | Vue Test Utils"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/facebook/jest/issues/3211#issuecomment-289276061",target:"_blank",rel:"noopener noreferrer"}},[t._v("setTimeout not triggering when unit testing · Issue #3211 · facebook/jest"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/azl397985856/automate-everything/blob/master/docs/chapter6.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("到处都是测试 automate-everything/chapter6.md at master · azl397985856/automate-everything"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://vuedose.tips/tips/quick-content-testing-using-snapshots-in-vue-js/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Quick Content Testing using Snapshots in Vue.js"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);