(window.webpackJsonp=window.webpackJsonp||[]).push([[244],{674:function(t,e,a){"use strict";a.r(e);var s=a(57),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"videojs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#videojs"}},[t._v("#")]),t._v(" videojs")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#_1-内联播放"}},[t._v("1. 内联播放")])]),a("li",[a("a",{attrs:{href:"#_2-自动播放"}},[t._v("2. 自动播放")])]),a("li",[a("a",{attrs:{href:"#_3-播放控制"}},[t._v("3. 播放控制")])]),a("li",[a("a",{attrs:{href:"#_4-隐藏播放控件"}},[t._v("4. 隐藏播放控件")])]),a("li",[a("a",{attrs:{href:"#直播"}},[t._v("直播")])]),a("li",[a("a",{attrs:{href:"#全屏事件"}},[t._v("全屏事件")])]),a("li",[a("a",{attrs:{href:"#在视频全屏上层显示元素"}},[t._v("在视频全屏上层显示元素")])]),a("li",[a("a",{attrs:{href:"#错误处理"}},[t._v("错误处理")])]),a("li",[a("a",{attrs:{href:"#测试资源"}},[t._v("测试资源")])]),a("li",[a("a",{attrs:{href:"#视频格式"}},[t._v("视频格式")])]),a("li",[a("a",{attrs:{href:"#播放器样式"}},[t._v("播放器样式")])]),a("li",[a("a",{attrs:{href:"#加密解密"}},[t._v("加密解密")])]),a("li",[a("a",{attrs:{href:"#关键指标监控上报"}},[t._v("关键指标监控上报")])]),a("li",[a("a",{attrs:{href:"#卸载和清除"}},[t._v("卸载和清除")])]),a("li",[a("a",{attrs:{href:"#倍速播放"}},[t._v("倍速播放")])]),a("li",[a("a",{attrs:{href:"#网络自适应"}},[t._v("网络自适应")])]),a("li",[a("a",{attrs:{href:"#data-setup"}},[t._v("data-setup")])]),a("li",[a("a",{attrs:{href:"#组件"}},[t._v("组件")])]),a("li",[a("a",{attrs:{href:"#fade"}},[t._v("fade")])]),a("li",[a("a",{attrs:{href:"#主题-theme"}},[t._v("主题 theme")])]),a("li",[a("a",{attrs:{href:"#点播使用-m3u8"}},[t._v("点播使用 m3u8")])]),a("li",[a("a",{attrs:{href:"#版本"}},[t._v("版本")])]),a("li",[a("a",{attrs:{href:"#_5-6-迁移"}},[t._v("5-6 迁移")])]),a("li",[a("a",{attrs:{href:"#恢复播放"}},[t._v("恢复播放")])]),a("li",[a("a",{attrs:{href:"#组件"}},[t._v("组件")])]),a("li",[a("a",{attrs:{href:"#timeupdate"}},[t._v("timeupdate")])]),a("li",[a("a",{attrs:{href:"#ref"}},[t._v("ref")])]),a("li",[a("a",{attrs:{href:"#mp4"}},[t._v("mp4")])]),a("li",[a("a",{attrs:{href:"#转码"}},[t._v("转码")])]),a("li",[a("a",{attrs:{href:"#估算网速"}},[t._v("估算网速")])]),a("li",[a("a",{attrs:{href:"#dash-hls"}},[t._v("DASH/HLS")])]),a("li",[a("a",{attrs:{href:"#如何监听交互事件"}},[t._v("如何监听交互事件")])]),a("li",[a("a",{attrs:{href:"#mime"}},[t._v("MIME")])]),a("li",[a("a",{attrs:{href:"#获取远程视频文件大小"}},[t._v("获取远程视频文件大小")])]),a("li",[a("a",{attrs:{href:"#源码"}},[t._v("源码")]),a("ul",[a("li",[a("a",{attrs:{href:"#player-js"}},[t._v("player.js")])]),a("li",[a("a",{attrs:{href:"#video-js"}},[t._v("video.js")])]),a("li",[a("a",{attrs:{href:"#component-js"}},[t._v("component.js")])]),a("li",[a("a",{attrs:{href:"#load-progress-bar-js"}},[t._v("load-progress-bar.js")])]),a("li",[a("a",{attrs:{href:"#fullscreen-api-js"}},[t._v("fullscreen-api.js")])]),a("li",[a("a",{attrs:{href:"#其它"}},[t._v("其它")])])])])])]),a("p"),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/videojs/video.js/blob/master/docs/guides/player-workflows.md#accesing-the-tech-on-the-player",target:"_blank",rel:"noopener noreferrer"}},[t._v("video.js/player-workflows.md at master · videojs/video.js · GitHub"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"_1-内联播放"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-内联播放"}},[t._v("#")]),t._v(" 1. 内联播放")]),t._v(" "),a("p",[t._v("在 video 标签加 webkit-playsinline, webkit-playsinline(iOS10) 属性 或者 webview.allowsInlineMediaPlayback = YES")]),t._v(" "),a("p",[t._v("iOS10 之前，不支持 参考这个 http://stackoverflow.com/a/37967643/5657916 "),a("a",{attrs:{href:"https://webkit.org/blog/6784/new-video-policies-for-ios/",target:"_blank",rel:"noopener noreferrer"}},[t._v("New video Policies for iOS | WebKit"),a("OutboundLink")],1),t._v("\n兼容 iOS 89 的方案\n"),a("a",{attrs:{href:"https://github.com/bfred-it/iphone-inline-video",target:"_blank",rel:"noopener noreferrer"}},[t._v("bfred-it/iphone-inline-video: 📱 Make videos playable inline on the iPhone (prevents automatic fullscreen)"),a("OutboundLink")],1),t._v("\n线上测试 https://bfred-it.github.io/iphone-inline-video/demo/")]),t._v(" "),a("p",[t._v("poster 在 android 下兼容不好，不如在视频上层加个 div 铺张图片\n解决：视频上加一层 div 做封面，由于 android 不允许视频上层有东西，所以首先将视频设为"),a("code",[t._v("width: 1px")]),t._v("，当播放后，上层的封面 remove 掉，同时"),a("code",[t._v("width：100%")]),t._v("或者你想要的宽度。")]),t._v(" "),a("h2",{attrs:{id:"_2-自动播放"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-自动播放"}},[t._v("#")]),t._v(" 2. 自动播放")]),t._v(" "),a("p",[t._v("android / chrome 70 是不允许自动播放的，即使你用了 video.play() ,也是不行的。必须有用户的主动触发，比如触摸了屏幕，有 click 或 touch 事件产生")]),t._v(" "),a("h2",{attrs:{id:"_3-播放控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-播放控制"}},[t._v("#")]),t._v(" 3. 播放控制")]),t._v(" "),a("p",[t._v("常用方法："),a("code",[t._v("play|pause")])]),t._v(" "),a("p",[t._v("常用事件：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("loadstart 开始加载\nloadedmetadata 元信息加载成功\nloadeddata 首帧加载成功\ncanplay\ncanplaythrough\nended\ntimeupdate\n")])])]),a("p",[t._v("ios 需要播放后才会触发"),a("code",[t._v("canplay")]),t._v("和"),a("code",[t._v("canplaythrough")])]),t._v(" "),a("h2",{attrs:{id:"_4-隐藏播放控件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-隐藏播放控件"}},[t._v("#")]),t._v(" 4. 隐藏播放控件")]),t._v(" "),a("p",[t._v("android 下无法隐藏控件，可通过增加高度将控件顶出视窗以间接实现，有些副作用需要处理")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://imweb.io/topic/560a6015c2317a8c3e086207",target:"_blank",rel:"noopener noreferrer"}},[t._v("video 标签在不同平台上的事件表现差异分析 - 腾讯 Web 前端 IMWeb 团队社区 | blog | 团队博客"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"http://webcache.googleusercontent.com/search?q=cache:K3Kfv-HA0sMJ:www.xuanfengge.com/html5-video-play.html+&cd=1&hl=zh-CN&ct=clnk&gl=cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("移动端 HTML5 video 视频播放优化实践 - 轩枫阁 – 前端开发 | web 前端技术博客"),a("OutboundLink")],1),t._v(" 2015 年的不一定新\n"),a("a",{attrs:{href:"https://github.com/mister-ben/videojs-flvjs",target:"_blank",rel:"noopener noreferrer"}},[t._v("mister-ben/videojs-flvjs: Video.js tech using flv.js for FLV playback"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"直播"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#直播"}},[t._v("#")]),t._v(" 直播")]),t._v(" "),a("ol",[a("li",[t._v("设置\nflv 需要引入")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("video.js\nflv.js\nvideojs-flvjs.js\n")])])]),a("p",[t._v("配置")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("  flvjs: {\n    mediaDataSource: {\n      isLive: true,\n      cors: true,\n      withCredentials: false,\n    },\n    // config: {},\n  },\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("界面")])]),t._v(" "),a("p",[t._v("检测"),a("code",[t._v("duartionChange")]),t._v("事件，UI 有变化，不符合只看直播的期望")]),t._v(" "),a("p",[t._v("videojs 在检测到直播流"),a("code",[t._v("duration < 0")]),t._v("才会切到"),a("code",[t._v("LIVE")]),t._v("样式，在"),a("code",[t._v("video-js")]),t._v("上添加"),a("code",[t._v("vjs-live")]),t._v("，新版还会加上"),a("code",[t._v("vjs-liveui")]),t._v("，新版有问题先不要用（安卓、seek）")]),t._v(" "),a("p",[t._v("vjs-live-control 刚开始会隐藏，需要 hack 处理")]),t._v(" "),a("div",{staticClass:"language-pug extra-class"},[a("pre",{pre:!0,attrs:{class:"language-pug"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[t._v(".video-js.vjs-live")]),t._v("\n")])])]),a("div",{staticClass:"language-css extra-class"},[a("pre",{pre:!0,attrs:{class:"language-css"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".vjs-live .vjs-control.vjs-live-control")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flex"),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("!important")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("需要找直播流测试？本地如何模拟 livego + ffmpeg")]),t._v(" "),a("p",[a("code",[t._v("ffmpeg -re -i aliyunmedia.mp4 -c copy -f flv rtmp://localhost/live/test")]),t._v("\n播放"),a("code",[t._v("http://localhost:7001/live/test.flv")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/videojs/video.js/blob/f5fd94f61012af2269a5528746c7d62a7b435467/src/js/player.js#L2485",target:"_blank",rel:"noopener noreferrer"}},[t._v("video.js/player.js at f5fd94f61012af2269a5528746c7d62a7b435467 · videojs/video.js"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/videojs/video.js/blob/6c644feaa0ccef6e5e88e8bf45dc9caa82a94503/docs/guides/live.md#the-new-user-interface",target:"_blank",rel:"noopener noreferrer"}},[t._v("video.js / live.md at 6c644feaa0ccef6e5e88e8bf45dc9caa82a94503·videojs / video.js"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"http://tests.nuevolab.com/videojs/tests/livestream",target:"_blank",rel:"noopener noreferrer"}},[t._v("VideoJs Live streaming example"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"全屏事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全屏事件"}},[t._v("#")]),t._v(" 全屏事件")]),t._v(" "),a("p",[t._v("只有一个"),a("code",[t._v("fullscreenchange")]),t._v("事件，要配合"),a("code",[t._v("isFullscreen")]),t._v("方法")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$refs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("videoPlayer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("player"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fullscreenchange'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" isFullscreen "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$refs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("videoPlayer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("player"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isFullscreen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'is fullscreen: '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" isFullscreen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("a",{attrs:{href:"https://github.com/videojs/video.js/issues/3009#issuecomment-172627411",target:"_blank",rel:"noopener noreferrer"}},[t._v("FullScreen Events · Issue #3009 · videojs/video.js"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("注意事件元素、方法，老版本 Chrome（如 63），Safari 等都需要前缀")]),t._v(" "),a("h2",{attrs:{id:"在视频全屏上层显示元素"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在视频全屏上层显示元素"}},[t._v("#")]),t._v(" 在视频全屏上层显示元素")]),t._v(" "),a("p",[t._v("场景：上课场景的题板展示，全屏时显示休息提示")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("自定义全屏元素\n思路：")]),t._v(" "),a("ol",[a("li",[t._v("卸载自带事件（视频上双击和点全屏按钮，文档可能找不到，通过捕获事件，查源码定位到）")]),t._v(" "),a("li",[t._v("给播放器和要前置元素的"),a("strong",[t._v("公共容器")]),t._v("设置全屏")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://gist.github.com/cyio/a838a85a87c14257427babd3ecf828e6",target:"_blank",rel:"noopener noreferrer"}},[t._v("videojs replaceFullscreen"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[t._v("如果只考虑 chrome，可以设置一个特别大的 z-index\nhttps://stackoverflow.com/a/16240314/5657916")])])]),t._v(" "),a("h2",{attrs:{id:"错误处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误处理"}},[t._v("#")]),t._v(" 错误处理")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Prevent “The play() request was interrupted by a call to pause()” error?")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Give the timeout enough time to avoid the race conflict.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" waitTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("150")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Resume play if the element if is paused.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("paused"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    el"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("play")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" waitTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"测试资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试资源"}},[t._v("#")]),t._v(" 测试资源")]),t._v(" "),a("p",[t._v("测试源：G33K-TRICKS - Your source to Tips and Tricks : List of HLS Streaming video sample test URL http://g33ktricks.blogspot.com.br/2016/04/list-of-hls-streaming-video-sample-test.html\n苹果的源有跨源限制，不要用")]),t._v(" "),a("p",[t._v("//player.alicdn.com/video/aliyunmedia.mp4")]),t._v(" "),a("p",[t._v("http://content.jwplatform.com/manifests/vM7nH0Kl.m3u8")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://standaloneinstaller.com/blog/big-list-of-sample-videos-for-testers-124.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Big list of sample videos for testers - standaloneinstaller.com"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.oschina.net/translate/http-partial-content-in-node-js",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js 中实现 HTTP 206 内容分片 - 开源中国"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"视频格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视频格式"}},[t._v("#")]),t._v(" 视频格式")]),t._v(" "),a("p",[t._v("查看"),a("code",[t._v("ffmpeg -i sample.flv")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/Bilibili/flv.js/issues/291#issuecomment-378025263",target:"_blank",rel:"noopener noreferrer"}},[t._v('Live FLV Stream on Android Chrome: "Playback seems stuck at 0, seek to 0.009" · Issue #291 · bilibili/flv.js'),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"播放器样式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#播放器样式"}},[t._v("#")]),t._v(" 播放器样式")]),t._v(" "),a("p",[t._v("16:9 自适应，高度有最大最小限制")]),t._v(" "),a("div",{staticClass:"language-css extra-class"},[a("pre",{pre:!0,attrs:{class:"language-css"}},[a("code",[a("span",{pre:!0,attrs:{class:"token property"}},[t._v("position")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" relative"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 100%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("calc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("9 / 16"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" * 100vw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("max-height")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("calc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("100vh - 169px"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min-height")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 480px"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("background")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" #000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("https://codepen.io/ncerminara/pen/zbKAD")]),t._v(" "),a("p",[t._v("http://stackoverflow.com/questions/25228056/responsive-iframe-using-bootstrap")]),t._v(" "),a("p",[t._v("原理：\n容器设置相对定位，宽度100%，高度由 padding-bottom 设置，视频撑满容器，随容器伸缩\n"),a("a",{attrs:{href:"https://github.com/surmon-china/vue-video-player/blob/master/examples/01-video.vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue-video-player/01-video.vue at master · surmon-china/vue-video-player"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"加密解密"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加密解密"}},[t._v("#")]),t._v(" 加密解密")]),t._v(" "),a("p",[t._v("支持 AES-128 segment encryption\n"),a("a",{attrs:{href:"https://www.linkedin.com/pulse/content-protection-hls-aes-128-encryption-steven-tielemans",target:"_blank",rel:"noopener noreferrer"}},[t._v("Content Protection for HLS with AES-128 Encryption"),a("OutboundLink")],1)]),t._v(" "),a("ul",[a("li",[t._v("密钥保护")]),t._v(" "),a("li",[t._v("防盗播，需要自建服务器")])]),t._v(" "),a("p",[t._v("比较：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("MPS 私有加密 - 阿里私有服务")]),t._v(" "),a("ul",[a("li",[t._v("不支持 H5（调研时）")]),t._v(" "),a("li",[t._v("必须使用阿里 CDN")]),t._v(" "),a("li",[t._v("安全性高")])])]),t._v(" "),a("li",[a("p",[t._v("HLS 标准加密")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/hauk0101/video-hls-encrypt",target:"_blank",rel:"noopener noreferrer"}},[t._v("hauk0101/video-hls-encrypt: 一个基于 hls 协议的视频加密 Demo"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://help.aliyun.com/document_detail/57113.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("视频加密"),a("em",[t._v("用户指南")]),t._v("媒体处理-阿里云"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.alibabacloud.com/help/zh/doc-detail/68565.htm",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何进行 HLS 的加密与播放 - 最佳实践| 阿里云"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.im/post/5c471a50f265da613a5452f6",target:"_blank",rel:"noopener noreferrer"}},[t._v("腾讯云点播 - 视频防盗加密 - 使用总结 - 掘金"),a("OutboundLink")],1)])])]),t._v(" "),a("h2",{attrs:{id:"关键指标监控上报"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关键指标监控上报"}},[t._v("#")]),t._v(" 关键指标监控上报")]),t._v(" "),a("ul",[a("li",[t._v("播放成功率 - play/canplay event")]),t._v(" "),a("li",[t._v("首次缓冲时间/加载延迟 = loadeddata - loadstart")]),t._v(" "),a("li",[t._v("缓冲概率")]),t._v(" "),a("li",[t._v("卡顿缓冲时长 = playing - waiting，忽略第一次 playing，如果大于一定值，收集网速信息，上报")]),t._v(" "),a("li",[t._v("播放次数")]),t._v(" "),a("li",[t._v("下载进度 video.duration video.buffered.end(0)")])]),t._v(" "),a("p",[t._v("收集信息：")]),t._v(" "),a("ul",[a("li",[t._v("视频地址")]),t._v(" "),a("li",[t._v("即时带宽")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://gist.github.com/cyio/13ff0ff11de9d5507958aea3343f3611",target:"_blank",rel:"noopener noreferrer"}},[t._v("视频加载延迟、卡顿计算及上报"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://blog.daraw.cn/2018/09/07/video-quality-monitor/",target:"_blank",rel:"noopener noreferrer"}},[t._v("前端视频质量监控 | DaraW | Code is Poetry"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://www.cnblogs.com/chenpingzhao/p/6850595.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("十亿级视频播放技术优化揭密 - 踏雪无痕 SS - 博客园"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"卸载和清除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#卸载和清除"}},[t._v("#")]),t._v(" 卸载和清除")]),t._v(" "),a("p",[t._v("一旦加载，会一直拉取，需要特殊操作停止拉取")]),t._v(" "),a("p",[t._v("需要两步，无法通过仅移除节点解决")]),t._v(" "),a("p",[t._v("一个页面视频比较多时，会阻塞后面的")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2) Clear the video source URL")]),t._v("\noldVideo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 3) Tell the video to start loading "nothing"')]),t._v("\noldVideo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("load")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("a",{attrs:{href:"https://stackoverflow.com/questions/28105950/html5-video-stalled-event",target:"_blank",rel:"noopener noreferrer"}},[t._v("javascript - HTML5 video: stalled event - Stack Overflow"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"倍速播放"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#倍速播放"}},[t._v("#")]),t._v(" 倍速播放")]),t._v(" "),a("ul",[a("li",[t._v("h5 原生支持")]),t._v(" "),a("li",[t._v("Chrome mutes the audio if the rate is lower than 0.5, or higher than 4.0.")]),t._v(" "),a("li",[t._v("常用值 1.5|2\n"),a("a",{attrs:{href:"https://github.com/videojs/videojs-playbackrate-adjuster",target:"_blank",rel:"noopener noreferrer"}},[t._v("videojs/videojs-playbackrate-adjuster: A Video.js 6 middleware that adjusts controls based on playback rate"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"网络自适应"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络自适应"}},[t._v("#")]),t._v(" 网络自适应")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://myslide.cn/slides/491?vertical=1",target:"_blank",rel:"noopener noreferrer"}},[t._v("播放器原理（何李石） | MySlide - 专注 PPT 分享，追随 SlideShare 和 SpeakerDeck 的脚步"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("清晰度：分为普清、高清、超清、原画和 4k，分别对应 360p、480p、720p、1080p 和以上")]),t._v(" "),a("p",[t._v("使用这个支持 v6 的 fork 版本")]),t._v(" "),a("p",[t._v("原插件只支持 v5，v6 变化较大，不要用 npm/cdn 版本，是旧的")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/neilhem/videojs-resolution-switcher",target:"_blank",rel:"noopener noreferrer"}},[t._v("neilhem/videojs-resolution-switcher: Resolution switcher adds the ability to select the video quality in video.js player."),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"data-setup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data-setup"}},[t._v("#")]),t._v(" data-setup")]),t._v(" "),a("p",[t._v("会自动初始化，不要和手动初始化同时使用")]),t._v(" "),a("h2",{attrs:{id:"组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#组件"}},[t._v("#")]),t._v(" 组件")]),t._v(" "),a("p",[t._v("排序")]),t._v(" "),a("ol",[a("li",[t._v("children 插件会影响")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("    children"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'playToggle'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'durationDisplay'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timeDivider'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'currentTimeDisplay'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'progressControl'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'volumePanel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fullscreenToggle'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("flex order tab 键切换还是按 html 顺序\n"),a("blockquote",[a("p",[t._v("Flex order change visual order, but html order stays the same. When you change focused element with your keyboard (TAB key) it keeps order defined by HTML. Tab index is scoped globally, so it is not right solution.")])])]),t._v(" "),a("li",[t._v("re-order your plugin initialization order so the plugins add their buttons in a different order.")])]),t._v(" "),a("h2",{attrs:{id:"fade"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fade"}},[t._v("#")]),t._v(" fade")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://stackoverflow.com/questions/24641448/video-js-force-control-bar-fade-out",target:"_blank",rel:"noopener noreferrer"}},[t._v("video.js: force control bar fade out - Stack Overflow"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"主题-theme"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主题-theme"}},[t._v("#")]),t._v(" 主题 theme")]),t._v(" "),a("p",[t._v("参考：\n"),a("a",{attrs:{href:"https://www.nuevolab.com/videojs/tests/hls",target:"_blank",rel:"noopener noreferrer"}},[t._v("Videojs HLS Adaptive Streaming with quality resolution picker"),a("OutboundLink")],1),t._v("\n百度网盘的视频播放也是基于 videojs")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://docs.videojs.com/docs/api/progress-control.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ProgressControl"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"点播使用-m3u8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#点播使用-m3u8"}},[t._v("#")]),t._v(" 点播使用 m3u8")]),t._v(" "),a("ul",[a("li",[t._v("可减轻服务器压力")]),t._v(" "),a("li",[t._v("首次加载更快？")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.helloweba.net/javascript/571.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTML5 点播 m3u8(hls)格式视频_Helloweba"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"http://www.ppvod.com/dianbo/wenti/443.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("为什么网络点播系统使用 m3u8 更有优势-PPVOD 视频点播源码/直播平台/服务器转码软件系统"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#版本"}},[t._v("#")]),t._v(" 版本")]),t._v(" "),a("p",[t._v("videojs 7 集成 "),a("a",{attrs:{href:"https://github.com/videojs/http-streaming",target:"_blank",rel:"noopener noreferrer"}},[t._v("http-streaming"),a("OutboundLink")],1),t._v(" 插件。如果不需要，使用 core.js")]),t._v(" "),a("h2",{attrs:{id:"_5-6-迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-6-迁移"}},[t._v("#")]),t._v(" 5-6 迁移")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("src()")]),t._v("改为异步")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("player"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'video/mp4'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'foo.mp4'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nplayer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ready")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("player"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("play"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("a",{attrs:{href:"https://github.com/videojs/video.js/wiki/Video.js-6-Migration-Guide",target:"_blank",rel:"noopener noreferrer"}},[t._v("Video.js 6 Migration Guide · videojs/video.js Wiki"),a("OutboundLink")],1)])])]),t._v(" "),a("h2",{attrs:{id:"恢复播放"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#恢复播放"}},[t._v("#")]),t._v(" 恢复播放")]),t._v(" "),a("ul",[a("li",[t._v("需要 loadedmetadata 发生后")]),t._v(" "),a("li",[t._v("需要校验有效性？")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("player"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastTimeCopy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nplayer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("play")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("a",{attrs:{href:"https://gist.github.com/alecsgone/a6db03bade4dc405a61c63294a64f97a",target:"_blank",rel:"noopener noreferrer"}},[t._v("VideoJS event list"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://juejin.im/post/5adb020df265da0b7c06d970",target:"_blank",rel:"noopener noreferrer"}},[t._v("[Video.js]隐藏和显示视频播放器控件 - 掘金"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"组件-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#组件-2"}},[t._v("#")]),t._v(" 组件")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://docs.videojs.com/tutorial-components.html#creating-a-component",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tutorial: components | Video.js Documentation"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"timeupdate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#timeupdate"}},[t._v("#")]),t._v(" timeupdate")]),t._v(" "),a("ul",[a("li",[t._v("50ms - 250ms")]),t._v(" "),a("li",[t._v("如果需要精确控制，可以使用"),a("code",[t._v("requestAnimationFrame")]),t._v("，并在里面检查"),a("code",[t._v("player.currentTime()")])])]),t._v(" "),a("h2",{attrs:{id:"ref"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ref"}},[t._v("#")]),t._v(" ref")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://vcloud.163.com/vcloud-sdk-manual/WebDemos/LivePlayer_Web/introToComponent.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("视频云web播放器样式和组件自定义"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"mp4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mp4"}},[t._v("#")]),t._v(" mp4")]),t._v(" "),a("p",[t._v("moov 需要放在开头，以启用 faststart")]),t._v(" "),a("p",[t._v("判断 moov 位置，在第一行（说明在开头），还是第二行（说明在末尾）")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# zsh 里后面命令需要转义")]),t._v("\nffmpeg -v trace -i file.mp4 "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" -e type:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("'mdat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("' -e type:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("'moov"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("'\n")])])]),a("p",[a("a",{attrs:{href:"https://stackoverflow.com/questions/56963790/how-to-tell-if-faststart-for-video-is-set-using-ffmpeg-or-ffprobe",target:"_blank",rel:"noopener noreferrer"}},[t._v("How to tell if faststart for video is set using ffmpeg or ffprobe - Stack Overflow"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://veerit.com/other/optimizing-mp4-video-for-fast-streaming-in-2019/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Optimizing MP4 Video for Fast Streaming in 2019 - VeerIT Solutions"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://segmentfault.com/a/1190000012477812",target:"_blank",rel:"noopener noreferrer"}},[t._v("在线短视频秒播优化之视频文件格式之MP4文件Moov box的位置 - 个人文章 - SegmentFault 思否"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("重新排序，moov 放到开头")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("ffmpeg -i input.mp4 -movflags faststart -acodec copy -vcodec copy output.mp4\n")])])]),a("h2",{attrs:{id:"转码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#转码"}},[t._v("#")]),t._v(" 转码")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://askubuntu.com/questions/352920/fastest-way-to-convert-videos-batch-or-single",target:"_blank",rel:"noopener noreferrer"}},[t._v("ffmpeg - Fastest way to convert videos (batch or single)? - Ask Ubuntu"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://trac.ffmpeg.org/wiki/Encode/H.264",target:"_blank",rel:"noopener noreferrer"}},[t._v("Encode/H.264 – FFmpeg"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://blog.csdn.net/u013010310/article/details/52371440",target:"_blank",rel:"noopener noreferrer"}},[t._v("FFMPEG推流到RTMP服务器命令 - u013010310的专栏 - CSDN博客"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://www.jianshu.com/p/6f345eaf3471",target:"_blank",rel:"noopener noreferrer"}},[t._v("ffmpeg录制摄像头 - 简书"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("img",{attrs:{src:"https://wx2.sinaimg.cn/large/69d3c9d2gy1g78ijxhwvxj20v00d6q7a.jpg",alt:"youtube 指标"}}),t._v(" "),a("a",{attrs:{href:"https://blog.csdn.net/chenchong_219/article/details/44263691",target:"_blank",rel:"noopener noreferrer"}},[t._v("MP4文件格式解析 - 心之所向，身之所往 - CSDN博客"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"http://www.chromium.org/audio-video",target:"_blank",rel:"noopener noreferrer"}},[t._v("Audio/Video - The Chromium Projects"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://www.w3.org/2018/12/webmediaguidelines.html#byte-range-requests-in-context-of-web-video-application",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web Media Application Developer Guidelines"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://medium.com/canal-tech/how-video-streaming-works-on-the-web-an-introduction-7919739f7e1",target:"_blank",rel:"noopener noreferrer"}},[t._v("How video streaming works on the web: An introduction"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("将1080p转成720p，宽度自适应")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("ffmpeg -i input.mkv -c copy -c:v libx264 -vf "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("scale")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-2:720 output.mkv\n")])])]),a("p",[a("a",{attrs:{href:"https://www.5yun.org/14696.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ffmpeg 将1080P视频转换成720P_楚盟网"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"估算网速"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#估算网速"}},[t._v("#")]),t._v(" 估算网速")]),t._v(" "),a("ol",[a("li",[t._v("文件大小/下载所用时间")]),t._v(" "),a("li",[t._v("视频下载本身符合上条")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://webapps.stackexchange.com/questions/106358/how-does-youtube-detect-connection-speed-without-testing-using-all-speeds",target:"_blank",rel:"noopener noreferrer"}},[t._v("How does YouTube detect connection speed without testing/using all speeds? - Web Applications Stack Exchange"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://stackoverflow.com/questions/5529718/how-to-detect-internet-speed-in-javascript",target:"_blank",rel:"noopener noreferrer"}},[t._v("How to detect internet speed in JavaScript? - Stack Overflow"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"dash-hls"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dash-hls"}},[t._v("#")]),t._v(" DASH/HLS")]),t._v(" "),a("p",[t._v("DASH 第一个国际标准")]),t._v(" "),a("p",[t._v("HLS 不是标准，chrome 移动端支持，pc 端可能永远不会支持")]),t._v(" "),a("blockquote",[a("p",[t._v("DASH客户端可以根据当前的网络状况，自动选择对应的最匹配的比特率文件段下载，进行回放，而不会引起停顿或重新缓冲。这样，DASH客户端可以无缝地适应不断变化的网络条件，并提供高品质的播放，而能够尽量减少播放的停顿或缓冲。\n虽然DASH是国际标准，但是 HLS 出现的更早，在业界占主流。")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.im/post/5d0892a0e51d455a694f9533",target:"_blank",rel:"noopener noreferrer"}},[t._v("权利的游戏、破冰行动都烂尾了，那就来讨论一下视频点播吧 - 掘金"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.bilibili.com/read/cv855111/",target:"_blank",rel:"noopener noreferrer"}},[t._v("我们为什么使用DASH - 哔哩哔哩"),a("OutboundLink")],1)]),t._v(" "),a("blockquote",[a("p",[t._v("HTMLVideoElement.getVideoPlaybackQuality() 中新增firstFrameTime（首帧时间）和bufferTimes（卡顿次数）以及希望获取总共可使用 MSE 的内存上限")])]),t._v(" "),a("p",[t._v("fmp4 不需要一个 moov Box 来进行 initialization，fmp4 的 moov Box 只包含了一些 track 信息。\nfmp4 可以结合 MSE 进行 HTML5 直播。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.w3.org/2019/03/23-chinese-web-media-summary.html#item05",target:"_blank",rel:"noopener noreferrer"}},[t._v("W3C Web 中文兴趣组媒体特别任务组研讨会 -- 2019年3月23日"),a("OutboundLink")],1)]),t._v(" "),a("blockquote",[a("p",[t._v("我们不看瞬时速度，而是对最近请求的4-10个分片计算平均值")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://h5player.bytedance.com/api/#getbufferedrange",target:"_blank",rel:"noopener noreferrer"}},[t._v("西瓜播放器 | API"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("播放本地视频，需要指定类型，blob 无法判断，不指定类型没有报错\n"),a("a",{attrs:{href:"https://stackoverflow.com/questions/36035721/how-can-i-set-preview-of-video-file-selecting-from-input-type-file/40580663",target:"_blank",rel:"noopener noreferrer"}},[t._v("javascript - How can I set preview of video file, selecting from input type='file' - Stack Overflow"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/videojs/video.js/issues/5504#issuecomment-481143136",target:"_blank",rel:"noopener noreferrer"}},[t._v("Blob Url Support broke with 7.2.1 · Issue #5504 · videojs/video.js"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"如何监听交互事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何监听交互事件"}},[t._v("#")]),t._v(" 如何监听交互事件")]),t._v(" "),a("p",[t._v("如用户操作触发暂停")]),t._v(" "),a("p",[t._v("pause 有问题，跳转也会触发，但可通过 readyState 区分开，4 是用户操作，1 是 seek 或加载时的用户操作")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://stackoverflow.com/questions/40584563/html5-video-fires-pause-event-while-seeked",target:"_blank",rel:"noopener noreferrer"}},[t._v("html - HTML5 video fires pause event while seeked - Stack Overflow"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("click，需要排除 dbclick，用户是在点击播放还是暂停")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://html.spec.whatwg.org/multipage/media.html#the-video-element",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTML Standard"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("img",{attrs:{src:"https://ws1.sinaimg.cn/large/4e5d3ea7ly1gb33uahrhvj20am08ct9n.jpg",alt:"image.png"}})]),t._v(" "),a("p",[t._v("监听交互事件可能更容易，缺点是如果通过快捷键跳转可能需要单独判断")]),t._v(" "),a("h2",{attrs:{id:"mime"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mime"}},[t._v("#")]),t._v(" MIME")]),t._v(" "),a("p",[t._v('"application/octet-stream" 例外 浏览器不会忽略')]),t._v(" "),a("h2",{attrs:{id:"获取远程视频文件大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取远程视频文件大小"}},[t._v("#")]),t._v(" 获取远程视频文件大小")]),t._v(" "),a("ul",[a("li",[t._v("额外发"),a("code",[t._v("HEAD")]),t._v("请求，获取"),a("code",[t._v("content-length")])]),t._v(" "),a("li",[t._v("需要服务器支持"),a("code",[t._v("HEAD")]),t._v("方法，需要支持CORS（可能是多个域名）。目前阿里 OSS 可以配多个、支持通配符，而 CDN 只支持配一个、精确")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://bitexperts.com/Question/Detail/3316/determine-file-size-in-javascript-without-downloading-a-file",target:"_blank",rel:"noopener noreferrer"}},[t._v("Determine file size in JavaScript without downloading a file"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("    // not work 如何延迟设置自动隐藏\n    // player.on('loadeddata', function() {\n    // this.options.inactivityTimeout = 2000\n    // })\n")])])]),a("h2",{attrs:{id:"源码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码"}},[t._v("#")]),t._v(" 源码")]),t._v(" "),a("h3",{attrs:{id:"player-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#player-js"}},[t._v("#")]),t._v(" player.js")]),t._v(" "),a("p",[t._v("TECH_EVENTS_RETRIGGER 注释描述各个事件作用 很清晰")]),t._v(" "),a("h3",{attrs:{id:"video-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#video-js"}},[t._v("#")]),t._v(" video.js")]),t._v(" "),a("p",[t._v("function videojs\n如果 player 实例存在，直接返回\n否则返回 new PlayerComponent\n方法属性方式扩展功能")]),t._v(" "),a("h3",{attrs:{id:"component-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#component-js"}},[t._v("#")]),t._v(" component.js")]),t._v(" "),a("p",[t._v("Component UI 基础类")]),t._v(" "),a("p",[t._v("是否存在有效 buffer 判断")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" buffered"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffered"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" currentTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n          currentTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" buffered"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SAFE_TIME_DELTA")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          extraBuffer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("buffered 百分比计算，遍历 buffered 并累加 / duration")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bufferedPercent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("buffered"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" duration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n")])])]),a("p",[t._v("内置依赖 xhr 库 https://github.com/naugtur/xhr")]),t._v(" "),a("p",[t._v("写 CSS 类\n姓名 复姓 新姓缩写")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/f2e-journey/xueqianban/issues/61",target:"_blank",rel:"noopener noreferrer"}},[t._v("视频直播的技术原理和实现思路方案整理 · Issue #61 · f2e-journey/xueqianban"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"load-progress-bar-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#load-progress-bar-js"}},[t._v("#")]),t._v(" load-progress-bar.js")]),t._v(" "),a("p",[t._v("进度条百分比计算")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("      const percent = percentify(bufferedEnd, duration);\n")])])]),a("p",[t._v("私有变量，下划线改放在后面")]),t._v(" "),a("p",[t._v("缓冲小区间展示 for buffered")]),t._v(" "),a("p",[t._v("估算网速，可以计算从时间 a 到时间 b 的 buffered 总时长变化 @todo")]),t._v(" "),a("p",[t._v("进度条更新，需要一直更新渲染，使用 rAF")]),t._v(" "),a("h3",{attrs:{id:"fullscreen-api-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fullscreen-api-js"}},[t._v("#")]),t._v(" fullscreen-api.js")]),t._v(" "),a("p",[t._v("适配器模式")]),t._v(" "),a("ol",[a("li",[t._v("不同浏览器 api 字典")]),t._v(" "),a("li",[t._v("检测当前浏览器支持哪个 api 集合"),a("code",[t._v("if (apiMap[i][1] in document) {")])]),t._v(" "),a("li",[t._v("适配成标准 api 语法 "),a("code",[t._v("FullscreenApi[specApi[i]] = browserApi[i];")])]),t._v(" "),a("li",[t._v("挂在 Player 类上")])]),t._v(" "),a("p",[t._v("优点：统一，test mock 不用再写一遍")]),t._v(" "),a("h3",{attrs:{id:"其它"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其它"}},[t._v("#")]),t._v(" 其它")]),t._v(" "),a("p",[t._v("worker? 字幕合成等\nhttps://github.com/videojs/http-streaming/blob/af5b4eee6605feb3a927efee1234f0ca49c32e72/src/media-segment-request.js#L472")]),t._v(" "),a("p",[t._v("concatSegments\nhttps://github.com/videojs/http-streaming/blob/e50f4c93dc47cc9ce467aeff8ddd61e1ef9e7814/src/util/segment.js#L43")]),t._v(" "),a("p",[t._v("appendBuffer\nhttps://github.com/videojs/http-streaming/blob/ea3650a08de481ac01f5562e54278e736a852e5c/src/segment-loader.js#L1918")])])}),[],!1,null,null,null);e.default=r.exports}}]);