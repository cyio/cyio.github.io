<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.37">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/favicon.ico"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#0089a7"><meta name="referrer" content="no-referrer"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><title>中间件设计 | Oaker小站</title><meta name="description" content="Just playing around">
    <link rel="modulepreload" href="/assets/app.de511a45.js"><link rel="modulepreload" href="/assets/middleware-pattern.html.2d3c3f2e.js"><link rel="modulepreload" href="/assets/middleware-pattern.html.7e6ec9ee.js">
    <link rel="stylesheet" href="/assets/style.5af559d1.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">Oaker小站</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/javascript/concept.html" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></div><div class="navbar-item"><a href="/web/html.html" class="" aria-label="Web"><!--[--><!--]--> Web <!--[--><!--]--></a></div><div class="navbar-item"><a href="/frameworks/vue.html" class="" aria-label="框架"><!--[--><!--]--> 框架 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/node/concept.html" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></div><div class="navbar-item"><a href="/tools/markdown.html" class="" aria-label="工具"><!--[--><!--]--> 工具 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/javascript/algorithms/index.html" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/javascript/solutions/fib.html" class="" aria-label="题解"><!--[--><!--]--> 题解 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/cyio" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/javascript/concept.html" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></div><div class="navbar-item"><a href="/web/html.html" class="" aria-label="Web"><!--[--><!--]--> Web <!--[--><!--]--></a></div><div class="navbar-item"><a href="/frameworks/vue.html" class="" aria-label="框架"><!--[--><!--]--> 框架 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/node/concept.html" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></div><div class="navbar-item"><a href="/tools/markdown.html" class="" aria-label="工具"><!--[--><!--]--> 工具 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/javascript/algorithms/index.html" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/javascript/solutions/fib.html" class="" aria-label="题解"><!--[--><!--]--> 题解 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/cyio" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">JavaScript <span class="down arrow"></span></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/javascript/animations.html" class="sidebar-item" aria-label="动画"><!--[--><!--]--> 动画 <!--[--><!--]--></a><!----></li><li><a href="/javascript/array.html" class="sidebar-item" aria-label="数组"><!--[--><!--]--> 数组 <!--[--><!--]--></a><!----></li><li><a href="/javascript/async.html" class="sidebar-item" aria-label="异步"><!--[--><!--]--> 异步 <!--[--><!--]--></a><!----></li><li><a href="/javascript/bit-operation.html" class="sidebar-item" aria-label="位运算"><!--[--><!--]--> 位运算 <!--[--><!--]--></a><!----></li><li><a href="/javascript/block-level-scope.html" class="sidebar-item" aria-label="块级作用域"><!--[--><!--]--> 块级作用域 <!--[--><!--]--></a><!----></li><li><a href="/javascript/class.html" class="sidebar-item" aria-label="class"><!--[--><!--]--> class <!--[--><!--]--></a><!----></li><li><a href="/javascript/closure.html" class="sidebar-item" aria-label="闭包"><!--[--><!--]--> 闭包 <!--[--><!--]--></a><!----></li><li><a href="/javascript/compose.html" class="sidebar-item" aria-label="函数合成"><!--[--><!--]--> 函数合成 <!--[--><!--]--></a><!----></li><li><a href="/javascript/concept.html" class="sidebar-item" aria-label="概念"><!--[--><!--]--> 概念 <!--[--><!--]--></a><!----></li><li><a href="/javascript/cross-origin.html" class="sidebar-item" aria-label="跨源（跨域）"><!--[--><!--]--> 跨源（跨域） <!--[--><!--]--></a><!----></li><li><a href="/javascript/date.html" class="sidebar-item" aria-label="Date"><!--[--><!--]--> Date <!--[--><!--]--></a><!----></li><li><a href="/javascript/debug.html" class="sidebar-item" aria-label="调试"><!--[--><!--]--> 调试 <!--[--><!--]--></a><!----></li><li><a href="/javascript/design-patterns.html" class="sidebar-item" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a><!----></li><li><a href="/javascript/encodings.html" class="sidebar-item" aria-label="字符编码"><!--[--><!--]--> 字符编码 <!--[--><!--]--></a><!----></li><li><a href="/javascript/errors-handle.html" class="sidebar-item" aria-label="错误处理"><!--[--><!--]--> 错误处理 <!--[--><!--]--></a><!----></li><li><a href="/javascript/ES6-proxy.html" class="sidebar-item" aria-label="Proxy"><!--[--><!--]--> Proxy <!--[--><!--]--></a><!----></li><li><a href="/javascript/ES6.html" class="sidebar-item" aria-label="ES6"><!--[--><!--]--> ES6 <!--[--><!--]--></a><!----></li><li><a href="/javascript/eslint.html" class="sidebar-item" aria-label="ESLint"><!--[--><!--]--> ESLint <!--[--><!--]--></a><!----></li><li><a href="/javascript/event-loop.html" class="sidebar-item" aria-label="事件循环"><!--[--><!--]--> 事件循环 <!--[--><!--]--></a><!----></li><li><a href="/javascript/fetch.html" class="sidebar-item" aria-label="fetch"><!--[--><!--]--> fetch <!--[--><!--]--></a><!----></li><li><a href="/javascript/for-while.html" class="sidebar-item" aria-label="循环"><!--[--><!--]--> 循环 <!--[--><!--]--></a><!----></li><li><a href="/javascript/form.html" class="sidebar-item" aria-label="表单"><!--[--><!--]--> 表单 <!--[--><!--]--></a><!----></li><li><a href="/javascript/function.html" class="sidebar-item" aria-label="函数"><!--[--><!--]--> 函数 <!--[--><!--]--></a><!----></li><li><a href="/javascript/iterator-pattern.html" class="sidebar-item" aria-label="iterator-pattern.md"><!--[--><!--]--> iterator-pattern.md <!--[--><!--]--></a><!----></li><li><a href="/javascript/math.html" class="sidebar-item" aria-label="math"><!--[--><!--]--> math <!--[--><!--]--></a><!----></li><li><a href="/javascript/memory.html" class="sidebar-item" aria-label="内存管理"><!--[--><!--]--> 内存管理 <!--[--><!--]--></a><!----></li><li><a href="/javascript/methods.html" class="sidebar-item" aria-label="常用方法"><!--[--><!--]--> 常用方法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/javascript/middleware-pattern.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="中间件设计"><!--[--><!--]--> 中间件设计 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/javascript/middleware-pattern.html#概念" class="router-link-active router-link-exact-active sidebar-item" aria-label="概念"><!--[--><!--]--> 概念 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/javascript/middleware-pattern.html#好处" class="router-link-active router-link-exact-active sidebar-item" aria-label="好处"><!--[--><!--]--> 好处 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/javascript/middleware-pattern.html#与-helper-区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="与 helper 区别"><!--[--><!--]--> 与 helper 区别 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/javascript/middleware-pattern.html#弊端" class="router-link-active router-link-exact-active sidebar-item" aria-label="弊端："><!--[--><!--]--> 弊端： <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/javascript/middleware-pattern.html#前端如何正确使用中间件" class="router-link-active router-link-exact-active sidebar-item" aria-label="前端如何正确使用中间件？"><!--[--><!--]--> 前端如何正确使用中间件？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/javascript/middleware-pattern.html#客户端应用" class="router-link-active router-link-exact-active sidebar-item" aria-label="客户端应用"><!--[--><!--]--> 客户端应用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/javascript/middleware-pattern.html#应用场景" class="router-link-active router-link-exact-active sidebar-item" aria-label="应用场景"><!--[--><!--]--> 应用场景 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/javascript/module.html" class="sidebar-item" aria-label="模块"><!--[--><!--]--> 模块 <!--[--><!--]--></a><!----></li><li><a href="/javascript/number.html" class="sidebar-item" aria-label="Number"><!--[--><!--]--> Number <!--[--><!--]--></a><!----></li><li><a href="/javascript/object.html" class="sidebar-item" aria-label="对象"><!--[--><!--]--> 对象 <!--[--><!--]--></a><!----></li><li><a href="/javascript/promise.html" class="sidebar-item" aria-label="Promise"><!--[--><!--]--> Promise <!--[--><!--]--></a><!----></li><li><a href="/javascript/pseudo-code.html" class="sidebar-item" aria-label="伪代码"><!--[--><!--]--> 伪代码 <!--[--><!--]--></a><!----></li><li><a href="/javascript/regexp.html" class="sidebar-item" aria-label="正则表达式"><!--[--><!--]--> 正则表达式 <!--[--><!--]--></a><!----></li><li><a href="/javascript/scope.html" class="sidebar-item" aria-label="作用域"><!--[--><!--]--> 作用域 <!--[--><!--]--></a><!----></li><li><a href="/javascript/service-worker.html" class="sidebar-item" aria-label="Service Worker"><!--[--><!--]--> Service Worker <!--[--><!--]--></a><!----></li><li><a href="/javascript/string.html" class="sidebar-item" aria-label="字符串"><!--[--><!--]--> 字符串 <!--[--><!--]--></a><!----></li><li><a href="/javascript/this.html" class="sidebar-item" aria-label="this"><!--[--><!--]--> this <!--[--><!--]--></a><!----></li><li><a href="/javascript/tricks.html" class="sidebar-item" aria-label="技巧"><!--[--><!--]--> 技巧 <!--[--><!--]--></a><!----></li><li><a href="/javascript/type.html" class="sidebar-item" aria-label="数据类型"><!--[--><!--]--> 数据类型 <!--[--><!--]--></a><!----></li><li><a href="/javascript/web-worker.html" class="sidebar-item" aria-label="web-worker"><!--[--><!--]--> web-worker <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="中间件设计" tabindex="-1"><a class="header-anchor" href="#中间件设计" aria-hidden="true">#</a> 中间件设计</h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/javascript/middleware-pattern.html#概念" class="router-link-active router-link-exact-active">概念</a></li><li><a aria-current="page" href="/javascript/middleware-pattern.html#好处" class="router-link-active router-link-exact-active">好处</a></li><li><a aria-current="page" href="/javascript/middleware-pattern.html#与-helper-区别" class="router-link-active router-link-exact-active">与 helper 区别</a></li><li><a aria-current="page" href="/javascript/middleware-pattern.html#弊端" class="router-link-active router-link-exact-active">弊端：</a></li><li><a aria-current="page" href="/javascript/middleware-pattern.html#前端如何正确使用中间件" class="router-link-active router-link-exact-active">前端如何正确使用中间件？</a></li><li><a aria-current="page" href="/javascript/middleware-pattern.html#客户端应用" class="router-link-active router-link-exact-active">客户端应用</a></li><li><a aria-current="page" href="/javascript/middleware-pattern.html#应用场景" class="router-link-active router-link-exact-active">应用场景</a></li></ul></nav><h2 id="概念" tabindex="-1"><a class="header-anchor" href="#概念" aria-hidden="true">#</a> 概念</h2><p>洋葱模型：（先从皮到心，再从心到皮）把代码流程化，让流水线更加清楚，且每一个中间件都有两次处理时机</p><p>每一个切面是一个中间件</p><p>一般用在数据请求流程中间</p><p>https://segmentfault.com/a/1190000023684453</p><h2 id="好处" tabindex="-1"><a class="header-anchor" href="#好处" aria-hidden="true">#</a> 好处</h2><blockquote><p>The best feature of middleware is that it&#39;s composable in a chain. You can use multiple independent third-party middleware in a single project.</p></blockquote><p>可组合性、拓展性</p><p>单个中间件应该足够简单，职责单一</p><h2 id="与-helper-区别" tabindex="-1"><a class="header-anchor" href="#与-helper-区别" aria-hidden="true">#</a> 与 helper 区别</h2><blockquote><p>ExpressJS is based on a pattern in which an incoming request is examined and possibly modified by a series of &quot;middleware&quot; objects. Every single enabled middleware receives every single incoming request. Sometimes they ignore the request, sometimes they add information to it for subsequent middleware objects, and sometimes they perform discreet actions like logging. Often they perform security functions such as checking where the incoming request is going and killing it if the user isn&#39;t sufficiently authorized.</p></blockquote><blockquote><p>A helper function often has nothing specifically to do with ExpressJS - it&#39;s just a function that exists to provide a place for common operations performed by otherwise unrelated objects to exist, to avoid these unrelated objects repeatedly re-implementing the same code.</p></blockquote><p><a href="https://www.reddit.com/r/node/comments/wgnyb8/difference_between_middlewares_and_helpers/" target="_blank" rel="noopener noreferrer">Difference between middlewares and helpers? : node<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="弊端" tabindex="-1"><a class="header-anchor" href="#弊端" aria-hidden="true">#</a> 弊端：</h2><ul><li>API 难理解，需要理解中件间运作机制和其他中间件</li><li>问题排查难度上升，不同中间件互相影响</li></ul><p>解决： 类似 egg 把业务逻辑做成 controller，背后是 koa 中件间，API 美化</p><h2 id="前端如何正确使用中间件" tabindex="-1"><a class="header-anchor" href="#前端如何正确使用中间件" aria-hidden="true">#</a> 前端如何正确使用中间件？</h2><p>每个中间件可以实现：</p><ol><li>实现独立的某个逻辑</li><li>控制后续的流程是否执行（权限、路由拦截、条件请求）</li><li>中间件前置、或后置逻辑</li></ol><h2 id="客户端应用" tabindex="-1"><a class="header-anchor" href="#客户端应用" aria-hidden="true">#</a> 客户端应用</h2><ul><li>中间件上下文不明确</li><li>中间件操作其它数据</li><li>看成服务层</li><li>中间件和下游使用者，是一拨人还是两拨人</li></ul><p>“中间件的这种模式，应该作为某个函数的装饰者模式来使用”</p><p><a href="https://vue3js.cn/interview/NodeJS/middleware.html" target="_blank" rel="noopener noreferrer">面试官：说说对中间件概念的理解，如何封装 node 中间件？ | web前端面试 - 面试官系列<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>逻辑复用、要组合性，通过将公共逻辑的处理编写在中间件中，可以不用在每一个接口回调中做相同的代码编写，减少了冗杂代码</p><p>request -&gt; middleware -&gt; response middleware 解析、鉴权、错误 中间件是从 http 请求开始到响应结束过程中的处理逻辑，通常需要对请求和响应进行处理</p><p>一般用在接口请求过程，HTTP 无状态，比较简单。而前端业务，数据存在交叉维护</p><p><a href="https://eggjs.github.io/zh/guide/middleware.html#%25E8%25B7%25AF%25E7%2594%25B1%25E4%25B8%25AD%25E9%2597%25B4%25E4%25BB%25B6" target="_blank" rel="noopener noreferrer">Middleware | Egg<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> https://oychao.github.io/2019/04/08/javascript/38_middleware_pattern/</p><p><a href="https://oychao.github.io/2019/04/08/javascript/38_middleware_pattern/" target="_blank" rel="noopener noreferrer">中间件模式在前端框架中的应用 | 传不习乎<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://juejin.cn/post/7110855173789990942" target="_blank" rel="noopener noreferrer">优化实战 第35期 - 优秀源码之中间件设计思想 - 掘金<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>两次处理时机分界点，<code>yield next</code></p><p>eggjs 插件和中间件的区别是，中间件一定是处理请求相关上下文的，但是插件不一定</p><h2 id="应用场景" tabindex="-1"><a class="header-anchor" href="#应用场景" aria-hidden="true">#</a> 应用场景</h2><p>分为：</p><ol><li>服务端框架：express/koa</li><li>前端库：数据管理(redux)、数据请求(axios 插件)</li></ol><p>Koa 请求加 header，token 校验，日志，异常处理，压缩，body 解析</p><p>Koa 的中间件栈以类似栈的方式流动，允许您在下游执行操作，然后过滤和操作上游响应。</p><p>express 不支持 async/await</p><p>redux 数据流添加 logger/debugger</p><p>axios 请求响应拦截器，没有 next，不算中间件。由第三方插件实现：https://emileber.github.io/axios-middleware</p><p>原理是 [请求中间件，发请求，响应中间件] 依次 Promise.then 处理</p><p><a href="https://juejin.cn/post/6988145927319994399" target="_blank" rel="noopener noreferrer">axios拦截器/koa中间件/express中间件/redux中间件的原理 - 掘金<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: gongyi01@baidu.com">gongyi01</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/javascript/methods.html" class="" aria-label="常用方法"><!--[--><!--]--> 常用方法 <!--[--><!--]--></a></span><span class="next"><a href="/javascript/module.html" class="" aria-label="模块"><!--[--><!--]--> 模块 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.de511a45.js" defer></script>
  </body>
</html>
